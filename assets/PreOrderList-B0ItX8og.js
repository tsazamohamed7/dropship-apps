import{z as E,a as L,d as G,p as $,f as M,w as S,r as y,i as X,A as J,e as F,c as p,j as b,o as f,b as e,t as m,k as N,B as H,F as z,q as T,v as D,l as A,C as B,u as V,y as W,n as U}from"./index-DRkvVQln.js";import{u as Y}from"./product.store-Diw4CXC0.js";const O={getAll(){return L({resource:"preorder"})},getById(s){return L({resource:"preorder",id:s})},createProduct(s){return E({resource:"preorder",method:"POST",...s})},update(s){return E({resource:"preorder",method:"PUT",...s})},deleteProduct(s){return E({resource:"preorder",method:"DELETE",preorder_id:s})},addCustomer(s){return E({resource:"preorder",method:"ADD_ITEM",...s})},removeCustomer(s){return E({resource:"preorder",method:"DELETE_ITEM",preorder_item_id:s})},finalize(s){return E({resource:"preorder",method:"FINALIZE",preorder_id:s})},received(s){return E({resource:"preorder",method:"RECEIVE",preorder_id:s})}},q=G("preOrder",{state:()=>({items:[],loading:!1}),actions:{async fetchPreOrders(){this.loading=!0;try{const s=await O.getAll();this.items=(s.data||[]).map(l=>({...l,id:l.preorder_id,customers:l.customers||[],_expanded:!1,_showActions:!1}))}finally{this.loading=!1}},async fetchPreOrderDetails(s){const l=this.items.find(r=>r.id===s);if(l){l._loadingItems=!0;try{const r=await O.getById(s);r.data&&(l.customers=(r.data.items||[]).map(a=>({id:a.preorder_item_id,name:a.customer_name,phone:a.phone,qty:a.qty})),l.status=r.data.status)}catch(r){console.error("Fetch pre-order details failed",r)}finally{l._loadingItems=!1}}},async createPreOrder(s){const l=$();l.info("Creating pre-order..."),await O.createProduct(s),await this.fetchPreOrders(),l.success("Pre-order product created")},async addCustomer(s){const l=$(),{pre_order_id:r}=s,a=this.items.find(x=>x.id===r);if(!a||a.status!=="OPEN"){l.error("Pre-order is not editable");return}await O.addCustomer(s),await this.fetchPreOrderDetails(r),l.success("Customer added")},async removeCustomer(s,l){const r=$(),a=this.items.find(x=>x.id===s);!a||a.status!=="OPEN"||(await O.removeCustomer(l),a.customers=a.customers.filter(x=>x.id!==l),r.success("Customer removed"))},async deletePreOrder(s){const l=$(),r=this.items.find(a=>a.id===s);if(r){if(r.status!=="OPEN"||r.customers.length>0){l.error("Cannot delete this pre-order");return}await O.deleteProduct(s),this.items=this.items.filter(a=>a.id!==s),l.success("Pre-order deleted")}},async updatePreOrder(s){const l=$();try{l.info("Updating pre-order..."),await O.update(s),await this.fetchPreOrders(),l.success("Pre-order updated")}catch(r){throw l.error("Failed to update pre-order"),r}},async finalize(s){const l=$();await O.finalize(s.id),s.status="FINALIZED",l.success("Pre-order finalized")},async received(s){const l=$();await O.received(s.id),s.status="RECEIVED",l.success("Marked as received")}}}),ee={class:"flex justify-between items-center border-b pb-2"},te={class:"text-lg font-bold text-slate-800"},se={class:"space-y-4"},le={class:"flex flex-col gap-2"},oe=["value"],re={key:0,class:"flex flex-col gap-1"},ae={class:"flex flex-col gap-1"},ne={class:"grid grid-cols-2 gap-4"},de={class:"flex flex-col gap-1"},ie=["disabled"],ue={class:"flex flex-col gap-1"},ce=["disabled"],fe={__name:"EditPreOrderProduct",props:{open:Boolean,preOrder:Object},emits:["close","save"],setup(s,{emit:l}){const r=Y(),a=y(""),x=y(!1);M(async()=>{await r.fetchSimpleProducts()});const _=F(()=>r.simpleItems),w=s,g=l,i=X({preorder_id:"",product_id:"",name:"",sku:"",last_open_date:"",expected_receive_date:"",status:"OPEN"}),P=F(()=>i.status==="OPEN");S(()=>w.open,k=>{if(k){if(x.value=!0,w.preOrder){const o={...w.preOrder},u=d=>d?d.split("T")[0]:"";o.last_open_date=u(o.last_open_date),o.expected_receive_date=u(o.expected_receive_date),Object.assign(i,o),a.value=o.product_id||""}else Object.assign(i,{preorder_id:"",product_id:"",name:"",sku:"",last_open_date:"",expected_receive_date:"",status:"OPEN"}),a.value="";J(()=>{x.value=!1})}},{immediate:!0}),S(a,k=>{if(!x.value&&k){const o=_.value.find(u=>u.product_id===k);if(!o)return;i.product_id=o.product_id,i.name=o.name,i.sku=o.sku;return}});function v(){g("close")}function j(){g("save",{...i,isNewProduct:!a.value})}return(k,o)=>s.open?(f(),p("div",{key:0,class:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:v},[e("div",{class:"absolute bottom-0 w-full bg-white rounded-t-3xl p-5 pb-24 space-y-4 shadow-2xl",onClick:o[5]||(o[5]=A(()=>{},["stop"]))},[e("div",ee,[e("h3",te,m(s.preOrder?"Edit Pre-Order Product":"Add Pre-Order Product"),1)]),e("div",se,[e("div",le,[o[7]||(o[7]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Product ",-1)),N(e("select",{"onUpdate:modelValue":o[0]||(o[0]=u=>a.value=u),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none"},[o[6]||(o[6]=e("option",{value:""},"-- Create New Product --",-1)),(f(!0),p(z,null,T(_.value,u=>(f(),p("option",{key:u.product_id,value:u.product_id},m(u.name),9,oe))),128))],512),[[H,a.value]])]),a.value?b("",!0):(f(),p("div",re,[o[8]||(o[8]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," New Product Name ",-1)),N(e("input",{"onUpdate:modelValue":o[1]||(o[1]=u=>i.name=u),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"e.g. Kuih Muih"},null,512),[[D,i.name]])])),e("div",ae,[o[9]||(o[9]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," SKU ",-1)),N(e("input",{"onUpdate:modelValue":o[2]||(o[2]=u=>i.sku=u),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"IP16-PRO-BLK"},null,512),[[D,i.sku]])]),e("div",ne,[e("div",de,[o[10]||(o[10]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Last Open Date ",-1)),N(e("input",{"onUpdate:modelValue":o[3]||(o[3]=u=>i.last_open_date=u),type:"date",disabled:!P.value,class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400"},null,8,ie),[[D,i.last_open_date]])]),e("div",ue,[o[11]||(o[11]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Expected Receive Date ",-1)),N(e("input",{"onUpdate:modelValue":o[4]||(o[4]=u=>i.expected_receive_date=u),type:"date",disabled:!P.value,class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400"},null,8,ce),[[D,i.expected_receive_date]])])])]),e("div",{class:"flex gap-3 pt-4"},[e("button",{class:"flex-1 bg-slate-100 text-slate-600 font-bold rounded-xl py-3 active:scale-95 transition-all",onClick:v}," Cancel "),e("button",{class:"flex-1 bg-slate-800 text-white font-bold rounded-xl py-3 shadow-lg active:scale-95 transition-all",onClick:j}," Save ")])])])):b("",!0)}},pe={class:"space-y-4"},xe={class:"flex flex-col gap-1"},be=["disabled"],me={class:"grid grid-cols-2 gap-4 items-end"},ve={class:"flex flex-col gap-1"},_e=["disabled"],ge={class:"flex flex-col gap-1"},he={class:"flex items-center justify-between bg-slate-50 p-1.5 rounded-xl border border-slate-100"},ye=["disabled"],we={class:"text-lg font-black text-slate-800"},ke=["disabled"],Pe={key:0,class:"text-xs font-bold text-slate-400 uppercase tracking-wide"},Oe={key:1,class:"text-sm font-bold text-rose-600"},Ce={class:"flex gap-3 pt-4"},Ee=["disabled"],$e=["disabled"],Ne={__name:"EditPreOrderCustomer",props:{open:Boolean,preOrder:{type:Object,required:!1,default:null}},emits:["close","saved"],setup(s,{emit:l}){const r=s,a=l,x=q(),_=y(""),w=y(""),g=y(1),i=y(!1),P=y(null),v=F(()=>r.preOrder?.status==="OPEN");S(()=>r.preOrder,u=>{u&&(_.value="",w.value="",g.value=1)},{immediate:!0});function j(){a("close")}function k(u){if(!v.value||i.value)return;const d=g.value+u;d>=1&&(g.value=d)}async function o(){if(v.value){P.value=null,i.value=!0;try{await x.addCustomer({pre_order_id:r.preOrder.id,name:_.value.trim(),phone:w.value.trim(),qty:g.value}),a("saved"),a("close")}catch(u){P.value=u?.message||"Failed to save customer"}finally{i.value=!1}}}return(u,d)=>s.open?(f(),p("div",{key:0,class:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:j},[e("div",{class:"absolute bottom-0 w-full bg-white rounded-t-3xl p-5 pb-24 space-y-4 shadow-2xl",onClick:d[4]||(d[4]=A(()=>{},["stop"]))},[d[10]||(d[10]=e("div",{class:"flex justify-between items-center border-b pb-2"},[e("h3",{class:"text-lg font-bold text-slate-800"}," Add Customer ")],-1)),e("div",pe,[e("div",xe,[d[5]||(d[5]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Customer Name ",-1)),N(e("input",{"onUpdate:modelValue":d[0]||(d[0]=C=>_.value=C),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400",placeholder:"e.g. John Tan",disabled:!v.value||i.value},null,8,be),[[D,_.value]])]),e("div",me,[e("div",ve,[d[6]||(d[6]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Phone Number ",-1)),N(e("input",{"onUpdate:modelValue":d[1]||(d[1]=C=>w.value=C),type:"tel",class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400",placeholder:"e.g. 012345...",disabled:!v.value||i.value},null,8,_e),[[D,w.value]])]),e("div",ge,[d[9]||(d[9]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Quantity ",-1)),e("div",he,[e("button",{type:"button",class:"w-9 h-9 flex items-center justify-center rounded-lg bg-white border border-slate-200 shadow-sm active:scale-90 disabled:opacity-50",onClick:d[2]||(d[2]=C=>k(-1)),disabled:g.value<=1||!v.value||i.value},[...d[7]||(d[7]=[e("span",{class:"text-lg font-bold text-slate-600"},"âˆ’",-1)])],8,ye),e("span",we,m(g.value),1),e("button",{type:"button",class:"w-9 h-9 flex items-center justify-center rounded-lg bg-slate-800 text-white shadow-md active:scale-90 disabled:opacity-50",onClick:d[3]||(d[3]=C=>k(1)),disabled:!v.value||i.value},[...d[8]||(d[8]=[e("span",{class:"text-lg font-bold"},"+",-1)])],8,ke)])])]),v.value?b("",!0):(f(),p("p",Pe," Customer can only be edited while status is OPEN ")),P.value?(f(),p("p",Oe,m(P.value),1)):b("",!0)]),e("div",Ce,[e("button",{class:"flex-1 bg-slate-100 text-slate-600 font-bold rounded-xl py-3 active:scale-95 transition-all",onClick:j,disabled:i.value}," Cancel ",8,Ee),e("button",{class:"flex-1 bg-slate-800 text-white font-bold rounded-xl py-3 shadow-lg active:scale-95 transition-all disabled:bg-slate-400",onClick:o,disabled:i.value||!v.value},m(i.value?"Saving...":"Save"),9,$e)])])])):b("",!0)}},Ae={class:"p-4 pb-24 space-y-3 bg-slate-50 min-h-screen font-sans"},je={key:0,class:"text-center py-20 text-slate-400"},De={class:"bg-white rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden h-28 flex z-20"},Ie=["onClick"],ze={class:"space-y-1"},Se={class:"font-black text-slate-800 leading-tight truncate w-48 text-base"},Fe={class:"text-[10px] text-slate-400 font-bold uppercase tracking-wide"},Te={class:"flex gap-1.5 mt-2"},Le={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-red-200 text-slate-600"},Be={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-slate-100 text-slate-600"},Ve=["onClick"],Ue={class:"absolute right-0 top-0 bottom-0 z-10 flex h-full bg-slate-50"},Me=["onClick"],qe=["onClick"],Qe=["onClick"],Re=["onClick"],Ze={key:0,class:"bg-white/60 border-x border-b border-slate-100 rounded-b-2xl -mt-4 pt-6 p-4 space-y-3 z-10 shadow-inner"},Ke={key:0,class:"flex items-center justify-center py-4 gap-2"},Ge={key:1,class:"space-y-2"},Xe={class:"flex gap-3 items-center"},Je={class:"h-6 w-6 flex items-center justify-center bg-slate-100 rounded-lg font-black text-slate-700"},He={class:"flex flex-col"},We={class:"font-bold text-slate-800"},Ye={class:"text-[10px] text-slate-400"},et=["onClick"],tt={class:"pt-2 border-t border-dashed border-slate-200 flex justify-between items-center px-1"},st={class:"text-[10px] font-bold text-slate-400 uppercase"},lt={class:"text-xs font-black text-slate-800"},ot={key:2,class:"text-center py-2 text-[10px] font-bold text-slate-400 uppercase"},dt={__name:"PreOrderList",setup(s){const l=q(),r=y(null),a=y(!1),x=y(!1),_=y(!1);M(()=>{l.fetchPreOrders()});function w(t){if(t._showActions){t._showActions=!1;return}t._expanded=!t._expanded,t._expanded&&(!t.customers||t.customers.length===0)&&l.fetchPreOrderDetails(t.id)}function g(t){t._showActions||(t._expanded=!1),l.items.forEach(c=>{c.id!==t.id&&(c._showActions=!1)}),t._showActions=!t._showActions}function i(t){return t.status==="OPEN"||t.status==="FINALIZED"}function P(t){return t.status==="OPEN"?192:t.status==="FINALIZED"?64:0}function v(t){return(t.customers||[]).reduce((c,n)=>c+n.qty,0)}function j(t){return t==="OPEN"?"bg-amber-100 text-amber-700":t==="FINALIZED"?"bg-sky-100 text-sky-700":"bg-emerald-100 text-emerald-700"}function k(){a.value=null,r.value=null,x.value=!0}function o(t){a.value=t,t._showActions=!1,r.value=t,x.value=!0}function u(t){t._showActions=!1,r.value=t,_.value=!0}function d(t){confirm("Finalize this pre-order?")&&(t._showActions=!1,l.finalize(t))}function C(t){confirm("Mark this pre-order as received?")&&(t._showActions=!1,l.received(t))}function Q(t,c){confirm("Remove this customer?")&&l.removeCustomer(t.id,c.id)}function I(){x.value=!1,_.value=!1,r.value=null,a.value=!1}async function R(t){a.value?await l.updatePreOrder(t):await l.createPreOrder(t),I()}async function Z(t){await l.addCustomerToPreOrder(t),I()}function K(t){if(!t)return"";const c=new Date(t);return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(c)}return(t,c)=>(f(),p(z,null,[e("div",Ae,[e("div",{class:"flex justify-between items-center mb-2"},[c[1]||(c[1]=e("h2",{class:"text-xl font-black text-slate-800 tracking-tight"},"Pre-Orders",-1)),e("button",{class:"w-10 h-10 flex items-center justify-center rounded-xl bg-slate-800 text-white shadow-sm active:scale-90 transition-all",onClick:k},[...c[0]||(c[0]=[e("span",{class:"text-xl"},"+",-1)])])]),V(l).loading?(f(),p("div",je,[...c[2]||(c[2]=[e("div",{class:"animate-spin inline-block w-8 h-8 border-4 border-slate-300 border-t-slate-800 rounded-full mb-4"},null,-1),e("p",{class:"font-bold text-sm"},"Synchronizing Pre-Orders...",-1)])])):b("",!0),(f(!0),p(z,null,T(V(l).items,n=>(f(),p("div",{key:n.id,class:"flex flex-col mb-4"},[e("div",De,[e("div",{class:"absolute inset-0 z-20 bg-white p-4 flex justify-between items-center transition-transform duration-300 ease-out",style:W({transform:n._showActions?`translateX(-${P(n)}px)`:"translateX(0)"}),onClick:h=>w(n)},[e("div",ze,[e("div",Se,m(n.name),1),e("div",Fe,m(n.sku),1),e("div",Te,[e("span",{class:U(["text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg",j(n.status)])},m(n.status),3),e("span",Le," ðŸ“… "+m(K(n.last_open_date)),1),e("span",Be," Qty : "+m(v(n)),1)])]),i(n)?(f(),p("button",{key:0,onClick:A(h=>g(n),["stop"]),class:"w-12 h-12 flex items-center justify-center text-slate-300 active:text-blue-500 transition-colors"},[e("i",{class:U(["fa text-2xl transition-transform duration-300",n._showActions?"fa-chevron-right":"fa-chevron-left"])},null,2)],8,Ve)):b("",!0)],12,Ie),e("div",Ue,[n.status==="OPEN"?(f(),p("button",{key:0,class:"w-16 bg-sky-500 text-white flex flex-col items-center justify-center gap-1",onClick:A(h=>o(n),["stop"])},[...c[3]||(c[3]=[e("i",{class:"fa fa-pencil text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Edit",-1)])],8,Me)):b("",!0),n.status==="OPEN"?(f(),p("button",{key:1,class:"w-16 bg-amber-400 text-amber-900 flex flex-col items-center justify-center gap-1",onClick:A(h=>u(n),["stop"])},[...c[4]||(c[4]=[e("i",{class:"fa fa-user-plus text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Add",-1)])],8,qe)):b("",!0),n.status==="OPEN"?(f(),p("button",{key:2,class:"w-16 bg-slate-800 text-white flex flex-col items-center justify-center gap-1",onClick:A(h=>d(n),["stop"])},[...c[5]||(c[5]=[e("i",{class:"fa fa-lock text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Finalize",-1)])],8,Qe)):b("",!0),n.status==="FINALIZED"?(f(),p("button",{key:3,class:"w-16 bg-emerald-500 text-white flex flex-col items-center justify-center gap-1",onClick:A(h=>C(n),["stop"])},[...c[6]||(c[6]=[e("i",{class:"fa fa-check-circle text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Received",-1)])],8,Re)):b("",!0)])]),n._expanded?(f(),p("div",Ze,[n._loadingItems?(f(),p("div",Ke,[...c[7]||(c[7]=[e("div",{class:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"},null,-1),e("span",{class:"text-[11px] font-bold text-slate-400 uppercase tracking-widest"},"Fetching Details",-1)])])):n.customers&&n.customers.length?(f(),p("div",Ge,[(f(!0),p(z,null,T(n.customers,h=>(f(),p("div",{key:h.id,class:"flex justify-between items-center text-xs bg-white p-2 rounded-xl border border-slate-50 shadow-sm"},[e("div",Xe,[e("span",Je,m(h.qty),1),e("div",He,[e("span",We,m(h.name),1),e("span",Ye,m(h.phone||""),1)])]),n.status==="OPEN"?(f(),p("button",{key:0,class:"text-rose-500 text-xs font-bold active:opacity-50",onClick:rt=>Q(n,h)}," Delete ",8,et)):b("",!0)]))),128)),e("div",tt,[e("span",st,"Total Customers: "+m(n.customers.length),1),e("span",lt,"Qty "+m(v(n)),1)])])):(f(),p("div",ot," No customers "))])):b("",!0)]))),128))]),x.value?(f(),B(fe,{key:0,open:x.value,preOrder:r.value,onClose:I,onSave:R},null,8,["open","preOrder"])):b("",!0),_.value&&r.value?(f(),B(Ne,{key:1,open:_.value,preOrder:r.value,onClose:I,onSaved:Z},null,8,["open","preOrder"])):b("",!0)],64))}};export{dt as default};
