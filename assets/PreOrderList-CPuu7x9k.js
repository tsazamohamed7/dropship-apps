import{i as P,a as S,d as R,j as E,w as U,k as Z,c as f,l as m,o as p,b as e,t as b,m as N,v as j,e as M,p as $,r as k,f as K,h as T,u as L,F as z,s as V,z as G,n as B}from"./index-CUyfDauE.js";const y={getAll(){return S({resource:"preorder"})},getById(t){return S({resource:"preorder",id:t})},create(t){return P({resource:"preorder",method:"POST",...t})},update(t){return P({resource:"preorder",method:"PUT",...t})},deleteProduct(t){return P({resource:"preorder",method:"DELETE",preorder_id:t})},addCustomer(t){return P({resource:"preorder",method:"ADD_ITEM",...t})},removeCustomer(t){return P({resource:"preorder",method:"DELETE_ITEM",preorder_item_id:t})},finalize(t){return P({resource:"preorder",method:"FINALIZE",preorder_id:t})},received(t){return P({resource:"preorder",method:"RECEIVE",preorder_id:t})}},q=R("preOrder",{state:()=>({items:[],loading:!1}),actions:{async fetchPreOrders(){this.loading=!0;try{const t=await y.getAll();this.items=(t.data||[]).map(s=>({...s,id:s.preorder_id,customers:s.customers||[],_expanded:!1,_showActions:!1}))}finally{this.loading=!1}},async fetchPreOrderDetails(t){const s=this.items.find(l=>l.id===t);if(s){s._loadingItems=!0;try{const l=await y.getById(t);l.data&&(s.customers=(l.data.items||[]).map(n=>({id:n.preorder_item_id,name:n.customer_name,phone:n.phone,qty:n.qty})),s.status=l.data.status)}catch(l){console.error("Fetch pre-order details failed",l)}finally{s._loadingItems=!1}}},async createPreOrder(t){const s=E();s.info("Creating pre-order..."),await y.createProduct(t),await this.fetchPreOrders(),s.success("Pre-order product created")},async addCustomer(t){const s=E(),{pre_order_id:l}=t,n=this.items.find(c=>c.id===l);if(!n||n.status!=="OPEN"){s.error("Pre-order is not editable");return}await y.addCustomer(t),await this.fetchPreOrderDetails(l),s.success("Customer added")},async removeCustomer(t,s){const l=E(),n=this.items.find(c=>c.id===t);!n||n.status!=="OPEN"||(await y.removeCustomer(s),n.customers=n.customers.filter(c=>c.id!==s),l.success("Customer removed"))},async deletePreOrder(t){const s=E(),l=this.items.find(n=>n.id===t);if(l){if(l.status!=="OPEN"||l.customers.length>0){s.error("Cannot delete this pre-order");return}await y.deleteProduct(t),this.items=this.items.filter(n=>n.id!==t),s.success("Pre-order deleted")}},async updatePreOrder(t){const s=E();try{s.info("Updating pre-order..."),await y.update(t),await this.fetchPreOrders(),s.success("Pre-order updated")}catch(l){throw s.error("Failed to update pre-order"),l}},async finalize(t){const s=E();await y.finalize(t.id),t.status="FINALIZED",s.success("Pre-order finalized")},async received(t){const s=E();await y.received(t.id),t.status="RECEIVED",s.success("Marked as received")}}}),X={class:"flex justify-between items-center border-b pb-2"},J={class:"text-lg font-bold text-slate-800"},H={class:"space-y-4"},W={class:"flex flex-col gap-1"},Y={class:"flex flex-col gap-1"},ee={class:"grid grid-cols-2 gap-4"},te={class:"flex flex-col gap-1"},se=["disabled"],oe={class:"flex flex-col gap-1"},le=["disabled"],re={__name:"EditPreOrderProduct",props:{open:Boolean,preOrder:Object},emits:["close","save"],setup(t,{emit:s}){const l=t,n=s,c=Z({preorder_id:"",name:"",sku:"",last_open_date:"",expected_receive_date:"",status:"OPEN"}),g=M(()=>c.status==="OPEN");U(()=>l.open,x=>{if(x)if(l.preOrder){const r={...l.preOrder},u=O=>O?O.split("T")[0]:"";r.last_open_date=u(r.last_open_date),r.expected_receive_date=u(r.expected_receive_date),Object.assign(c,r)}else Object.assign(c,{preorder_id:"",name:"",sku:"",last_open_date:"",expected_receive_date:"",status:"OPEN"})});function _(){n("close")}function h(){n("save",{...c})}return(x,r)=>t.open?(p(),f("div",{key:0,class:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:_},[e("div",{class:"absolute bottom-0 w-full bg-white rounded-t-3xl p-5 pb-24 space-y-4 shadow-2xl",onClick:r[4]||(r[4]=$(()=>{},["stop"]))},[e("div",X,[e("h3",J,b(t.preOrder?"Edit Pre-Order Product":"Add Pre-Order Product"),1)]),e("div",H,[e("div",W,[r[5]||(r[5]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Product Name ",-1)),N(e("input",{"onUpdate:modelValue":r[0]||(r[0]=u=>c.name=u),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"e.g. Kuih Muih"},null,512),[[j,c.name]])]),e("div",Y,[r[6]||(r[6]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," SKU ",-1)),N(e("input",{"onUpdate:modelValue":r[1]||(r[1]=u=>c.sku=u),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"IP16-PRO-BLK"},null,512),[[j,c.sku]])]),e("div",ee,[e("div",te,[r[7]||(r[7]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Last Open Date ",-1)),N(e("input",{"onUpdate:modelValue":r[2]||(r[2]=u=>c.last_open_date=u),type:"date",disabled:!g.value,class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400"},null,8,se),[[j,c.last_open_date]])]),e("div",oe,[r[8]||(r[8]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Expected Receive Date ",-1)),N(e("input",{"onUpdate:modelValue":r[3]||(r[3]=u=>c.expected_receive_date=u),type:"date",disabled:!g.value,class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400"},null,8,le),[[j,c.expected_receive_date]])])])]),e("div",{class:"flex gap-3 pt-4"},[e("button",{class:"flex-1 bg-slate-100 text-slate-600 font-bold rounded-xl py-3 active:scale-95 transition-all",onClick:_}," Cancel "),e("button",{class:"flex-1 bg-slate-800 text-white font-bold rounded-xl py-3 shadow-lg active:scale-95 transition-all",onClick:h}," Save ")])])])):m("",!0)}},ae={class:"space-y-4"},ne={class:"flex flex-col gap-1"},de=["disabled"],ie={class:"grid grid-cols-2 gap-4 items-end"},ce={class:"flex flex-col gap-1"},ue=["disabled"],fe={class:"flex flex-col gap-1"},pe={class:"flex items-center justify-between bg-slate-50 p-1.5 rounded-xl border border-slate-100"},xe=["disabled"],be={class:"text-lg font-black text-slate-800"},me=["disabled"],ve={key:0,class:"text-xs font-bold text-slate-400 uppercase tracking-wide"},he={key:1,class:"text-sm font-bold text-rose-600"},ge={class:"flex gap-3 pt-4"},_e=["disabled"],ye=["disabled"],we={__name:"EditPreOrderCustomer",props:{open:Boolean,preOrder:{type:Object,required:!0}},emits:["close","saved"],setup(t,{emit:s}){const l=t,n=s,c=q(),g=k(""),_=k(""),h=k(1),x=k(!1),r=k(null),u=M(()=>l.preOrder.status==="OPEN");U(()=>l.preOrder,w=>{w&&(g.value="",_.value="",h.value=1)},{immediate:!0});function O(){n("close")}function A(w){if(!u.value||x.value)return;const d=h.value+w;d>=1&&(h.value=d)}async function D(){if(u.value){r.value=null,x.value=!0;try{await c.addCustomer({pre_order_id:l.preOrder.id,name:g.value.trim(),phone:_.value.trim(),qty:h.value}),n("saved"),n("close")}catch(w){r.value=w?.message||"Failed to save customer"}finally{x.value=!1}}}return(w,d)=>t.open?(p(),f("div",{key:0,class:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:O},[e("div",{class:"absolute bottom-0 w-full bg-white rounded-t-3xl p-5 pb-24 space-y-4 shadow-2xl",onClick:d[4]||(d[4]=$(()=>{},["stop"]))},[d[10]||(d[10]=e("div",{class:"flex justify-between items-center border-b pb-2"},[e("h3",{class:"text-lg font-bold text-slate-800"}," Add Customer ")],-1)),e("div",ae,[e("div",ne,[d[5]||(d[5]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Customer Name ",-1)),N(e("input",{"onUpdate:modelValue":d[0]||(d[0]=C=>g.value=C),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400",placeholder:"e.g. John Tan",disabled:!u.value||x.value},null,8,de),[[j,g.value]])]),e("div",ie,[e("div",ce,[d[6]||(d[6]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Phone Number ",-1)),N(e("input",{"onUpdate:modelValue":d[1]||(d[1]=C=>_.value=C),type:"tel",class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400",placeholder:"e.g. 012345...",disabled:!u.value||x.value},null,8,ue),[[j,_.value]])]),e("div",fe,[d[9]||(d[9]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Quantity ",-1)),e("div",pe,[e("button",{type:"button",class:"w-9 h-9 flex items-center justify-center rounded-lg bg-white border border-slate-200 shadow-sm active:scale-90 disabled:opacity-50",onClick:d[2]||(d[2]=C=>A(-1)),disabled:h.value<=1||!u.value||x.value},[...d[7]||(d[7]=[e("span",{class:"text-lg font-bold text-slate-600"},"âˆ’",-1)])],8,xe),e("span",be,b(h.value),1),e("button",{type:"button",class:"w-9 h-9 flex items-center justify-center rounded-lg bg-slate-800 text-white shadow-md active:scale-90 disabled:opacity-50",onClick:d[3]||(d[3]=C=>A(1)),disabled:!u.value||x.value},[...d[8]||(d[8]=[e("span",{class:"text-lg font-bold"},"+",-1)])],8,me)])])]),u.value?m("",!0):(p(),f("p",ve," Customer can only be edited while status is OPEN ")),r.value?(p(),f("p",he,b(r.value),1)):m("",!0)]),e("div",ge,[e("button",{class:"flex-1 bg-slate-100 text-slate-600 font-bold rounded-xl py-3 active:scale-95 transition-all",onClick:O,disabled:x.value}," Cancel ",8,_e),e("button",{class:"flex-1 bg-slate-800 text-white font-bold rounded-xl py-3 shadow-lg active:scale-95 transition-all disabled:bg-slate-400",onClick:D,disabled:x.value||!u.value},b(x.value?"Saving...":"Save"),9,ye)])])])):m("",!0)}},ke={class:"p-4 pb-24 space-y-3 bg-slate-50 min-h-screen font-sans"},Oe={key:0,class:"text-center py-20 text-slate-400"},Ce={class:"bg-white rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden h-28 flex z-20"},Pe=["onClick"],Ee={class:"space-y-1"},$e={class:"font-black text-slate-800 leading-tight truncate w-48 text-base"},Ne={class:"text-[10px] text-slate-400 font-bold uppercase tracking-wide"},je={class:"flex gap-1.5 mt-2"},Ae={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-red-200 text-slate-600"},De={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-slate-100 text-slate-600"},Ie=["onClick"],ze={class:"absolute right-0 top-0 bottom-0 z-10 flex h-full bg-slate-50"},Fe=["onClick"],Se=["onClick"],Te=["onClick"],Le=["onClick"],Ve={key:0,class:"bg-white/60 border-x border-b border-slate-100 rounded-b-2xl -mt-4 pt-6 p-4 space-y-3 z-10 shadow-inner"},Be={key:0,class:"flex items-center justify-center py-4 gap-2"},Ue={key:1,class:"space-y-2"},Me={class:"flex gap-3 items-center"},qe={class:"h-6 w-6 flex items-center justify-center bg-slate-100 rounded-lg font-black text-slate-700"},Qe={class:"flex flex-col"},Re={class:"font-bold text-slate-800"},Ze={class:"text-[10px] text-slate-400"},Ke=["onClick"],Ge={class:"pt-2 border-t border-dashed border-slate-200 flex justify-between items-center px-1"},Xe={class:"text-[10px] font-bold text-slate-400 uppercase"},Je={class:"text-xs font-black text-slate-800"},He={key:2,class:"text-center py-2 text-[10px] font-bold text-slate-400 uppercase"},et={__name:"PreOrderList",setup(t){const s=q(),l=k(null),n=k(!1),c=k(!1);K(()=>{s.fetchPreOrders()});function g(o){if(o._showActions){o._showActions=!1;return}o._expanded=!o._expanded,o._expanded&&(!o.customers||o.customers.length===0)&&s.fetchPreOrderDetails(o.id)}function _(o){o._showActions||(o._expanded=!1),s.items.forEach(i=>{i.id!==o.id&&(i._showActions=!1)}),o._showActions=!o._showActions}function h(o){return o.status==="OPEN"||o.status==="FINALIZED"}function x(o){return o.status==="OPEN"?192:o.status==="FINALIZED"?64:0}function r(o){return(o.customers||[]).reduce((i,a)=>i+a.qty,0)}function u(o){return o==="OPEN"?"bg-amber-100 text-amber-700":o==="FINALIZED"?"bg-sky-100 text-sky-700":"bg-emerald-100 text-emerald-700"}function O(){l.value=null,n.value=!0}function A(o){l.value=o,n.value=!0}function D(o){l.value=o,c.value=!0}function w(o){confirm("Finalize this pre-order?")&&s.finalize(o)}function d(o){confirm("Mark this pre-order as received?")&&s.received(o)}function C(o,i){confirm("Remove this customer?")&&s.removeCustomer(o.id,i.id)}function I(){n.value=!1,c.value=!1,l.value=null}async function F(o){await s.updatePreOrder(o),I()}function Q(o){if(!o)return"";const i=new Date(o);return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(i)}return(o,i)=>(p(),f(z,null,[e("div",ke,[e("div",{class:"flex justify-between items-center mb-2"},[i[1]||(i[1]=e("h2",{class:"text-xl font-black text-slate-800 tracking-tight"},"Pre-Orders",-1)),e("button",{class:"w-10 h-10 flex items-center justify-center rounded-xl bg-slate-800 text-white shadow-sm active:scale-90 transition-all",onClick:O},[...i[0]||(i[0]=[e("span",{class:"text-xl"},"+",-1)])])]),L(s).loading?(p(),f("div",Oe,[...i[2]||(i[2]=[e("div",{class:"animate-spin inline-block w-8 h-8 border-4 border-slate-300 border-t-slate-800 rounded-full mb-4"},null,-1),e("p",{class:"font-bold text-sm"},"Synchronizing Pre-Orders...",-1)])])):m("",!0),(p(!0),f(z,null,V(L(s).items,a=>(p(),f("div",{key:a.id,class:"flex flex-col mb-4"},[e("div",Ce,[e("div",{class:"absolute inset-0 z-20 bg-white p-4 flex justify-between items-center transition-transform duration-300 ease-out",style:G({transform:a._showActions?`translateX(-${x(a)}px)`:"translateX(0)"}),onClick:v=>g(a)},[e("div",Ee,[e("div",$e,b(a.name),1),e("div",Ne,b(a.sku),1),e("div",je,[e("span",{class:B(["text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg",u(a.status)])},b(a.status),3),e("span",Ae," ðŸ“… "+b(Q(a.last_open_date)),1),e("span",De," Qty : "+b(r(a)),1)])]),h(a)?(p(),f("button",{key:0,onClick:$(v=>_(a),["stop"]),class:"w-12 h-12 flex items-center justify-center text-slate-300 active:text-blue-500 transition-colors"},[e("i",{class:B(["fa text-2xl transition-transform duration-300",a._showActions?"fa-chevron-right":"fa-chevron-left"])},null,2)],8,Ie)):m("",!0)],12,Pe),e("div",ze,[a.status==="OPEN"?(p(),f("button",{key:0,class:"w-16 bg-sky-500 text-white flex flex-col items-center justify-center gap-1",onClick:$(v=>A(a),["stop"])},[...i[3]||(i[3]=[e("i",{class:"fa fa-pencil text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Edit",-1)])],8,Fe)):m("",!0),a.status==="OPEN"?(p(),f("button",{key:1,class:"w-16 bg-amber-400 text-amber-900 flex flex-col items-center justify-center gap-1",onClick:$(v=>D(a),["stop"])},[...i[4]||(i[4]=[e("i",{class:"fa fa-user-plus text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Add",-1)])],8,Se)):m("",!0),a.status==="OPEN"?(p(),f("button",{key:2,class:"w-16 bg-slate-800 text-white flex flex-col items-center justify-center gap-1",onClick:$(v=>w(a),["stop"])},[...i[5]||(i[5]=[e("i",{class:"fa fa-lock text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Finalize",-1)])],8,Te)):m("",!0),a.status==="FINALIZED"?(p(),f("button",{key:3,class:"w-16 bg-emerald-500 text-white flex flex-col items-center justify-center gap-1",onClick:$(v=>d(a),["stop"])},[...i[6]||(i[6]=[e("i",{class:"fa fa-check-circle text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Received",-1)])],8,Le)):m("",!0)])]),a._expanded?(p(),f("div",Ve,[a._loadingItems?(p(),f("div",Be,[...i[7]||(i[7]=[e("div",{class:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"},null,-1),e("span",{class:"text-[11px] font-bold text-slate-400 uppercase tracking-widest"},"Fetching Details",-1)])])):a.customers&&a.customers.length?(p(),f("div",Ue,[(p(!0),f(z,null,V(a.customers,v=>(p(),f("div",{key:v.id,class:"flex justify-between items-center text-xs bg-white p-2 rounded-xl border border-slate-50 shadow-sm"},[e("div",Me,[e("span",qe,b(v.qty),1),e("div",Qe,[e("span",Re,b(v.name),1),e("span",Ze,b(v.phone||""),1)])]),a.status==="OPEN"?(p(),f("button",{key:0,class:"text-rose-500 text-xs font-bold active:opacity-50",onClick:We=>C(a,v)}," Delete ",8,Ke)):m("",!0)]))),128)),e("div",Ge,[e("span",Xe,"Total Customers: "+b(a.customers.length),1),e("span",Je,"Qty "+b(r(a)),1)])])):(p(),f("div",He," No customers "))])):m("",!0)]))),128))]),T(re,{open:n.value,preOrder:l.value,onClose:I,onSave:F},null,8,["open","preOrder"]),T(we,{open:c.value,preOrder:l.value,onClose:I,onSaved:F},null,8,["open","preOrder"])],64))}};export{et as default};
