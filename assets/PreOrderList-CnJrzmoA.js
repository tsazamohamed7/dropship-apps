import{i as O,a as F,d as R,j as E,w as U,k as Z,c as u,l as m,o as f,b as e,t as b,m as $,v as N,e as q,p as P,r as k,f as G,h as L,u as T,F as z,s as V,z as K,n as B}from"./index-2VRVHHYX.js";const w={getAll(){return F({resource:"preorder"})},getById(t){return F({resource:"preorder",id:t})},create(t){return O({resource:"preorder",method:"POST",...t})},update(t){return O({resource:"preorder",method:"PUT",...t})},deleteProduct(t){return O({resource:"preorder",method:"DELETE",preorder_id:t})},addCustomer(t){return O({resource:"preorder",method:"ADD_ITEM",...t})},removeCustomer(t){return O({resource:"preorder",method:"DELETE_ITEM",preorder_item_id:t})},finalize(t){return O({resource:"preorder",method:"FINALIZE",preorder_id:t})},received(t){return O({resource:"preorder",method:"RECEIVE",preorder_id:t})}},M=R("preOrder",{state:()=>({items:[],loading:!1}),actions:{async fetchPreOrders(){this.loading=!0;try{const t=await w.getAll();this.items=(t.data||[]).map(s=>({...s,id:s.preorder_id,customers:s.customers||[],_expanded:!1,_showActions:!1}))}finally{this.loading=!1}},async fetchPreOrderDetails(t){const s=this.items.find(r=>r.id===t);if(s){s._loadingItems=!0;try{const r=await w.getById(t);r.data&&(s.customers=(r.data.items||[]).map(a=>({id:a.preorder_item_id,name:a.customer_name,phone:a.phone,qty:a.qty})),s.status=r.data.status)}catch(r){console.error("Fetch pre-order details failed",r)}finally{s._loadingItems=!1}}},async createPreOrder(t){const s=E();s.info("Creating pre-order..."),await w.createProduct(t),await this.fetchPreOrders(),s.success("Pre-order product created")},async addCustomer(t){const s=E(),{pre_order_id:r}=t,a=this.items.find(c=>c.id===r);if(!a||a.status!=="OPEN"){s.error("Pre-order is not editable");return}await w.addCustomer(t),await this.fetchPreOrderDetails(r),s.success("Customer added")},async removeCustomer(t,s){const r=E(),a=this.items.find(c=>c.id===t);!a||a.status!=="OPEN"||(await w.removeCustomer(s),a.customers=a.customers.filter(c=>c.id!==s),r.success("Customer removed"))},async deletePreOrder(t){const s=E(),r=this.items.find(a=>a.id===t);if(r){if(r.status!=="OPEN"||r.customers.length>0){s.error("Cannot delete this pre-order");return}await w.deleteProduct(t),this.items=this.items.filter(a=>a.id!==t),s.success("Pre-order deleted")}},async finalize(t){const s=E();await w.finalize(t.id),t.status="FINALIZED",s.success("Pre-order finalized")},async received(t){const s=E();await w.received(t.id),t.status="RECEIVED",s.success("Marked as received")}}}),X={class:"flex justify-between items-center border-b pb-2"},J={class:"text-lg font-bold text-slate-800"},H={class:"space-y-4"},W={class:"flex flex-col gap-1"},Y={class:"flex flex-col gap-1"},ee={class:"grid grid-cols-2 gap-4"},te={class:"flex flex-col gap-1"},se=["disabled"],le={class:"flex flex-col gap-1"},oe=["disabled"],re={__name:"EditPreOrderProduct",props:{open:Boolean,preOrder:Object},emits:["close","save"],setup(t,{emit:s}){const r=t,a=s,c=Z({preorder_id:"",name:"",sku:"",last_open_date:"",expected_receive_date:"",status:"OPEN"}),h=q(()=>c.status==="OPEN");U(()=>r.open,x=>{x&&(r.preOrder?Object.assign(c,r.preOrder):Object.assign(c,{preorder_id:"",name:"",sku:"",last_open_date:"",expected_receive_date:"",status:"OPEN"}))});function _(){a("close")}function g(){a("save",{...c})}return(x,i)=>t.open?(f(),u("div",{key:0,class:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:_},[e("div",{class:"absolute bottom-0 w-full bg-white rounded-t-3xl p-5 pb-24 space-y-4 shadow-2xl",onClick:i[4]||(i[4]=P(()=>{},["stop"]))},[e("div",X,[e("h3",J,b(t.preOrder?"Edit Pre-Order Product":"Add Pre-Order Product"),1)]),e("div",H,[e("div",W,[i[5]||(i[5]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Product Name ",-1)),$(e("input",{"onUpdate:modelValue":i[0]||(i[0]=p=>c.name=p),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"e.g. iPhone 16 Pro"},null,512),[[N,c.name]])]),e("div",Y,[i[6]||(i[6]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," SKU ",-1)),$(e("input",{"onUpdate:modelValue":i[1]||(i[1]=p=>c.sku=p),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"IP16-PRO-BLK"},null,512),[[N,c.sku]])]),e("div",ee,[e("div",te,[i[7]||(i[7]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Last Open Date ",-1)),$(e("input",{"onUpdate:modelValue":i[2]||(i[2]=p=>c.last_open_date=p),type:"date",disabled:!h.value,class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400"},null,8,se),[[N,c.last_open_date]])]),e("div",le,[i[8]||(i[8]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Expected Receive Date ",-1)),$(e("input",{"onUpdate:modelValue":i[3]||(i[3]=p=>c.expected_receive_date=p),type:"date",disabled:!h.value,class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400"},null,8,oe),[[N,c.expected_receive_date]])])])]),e("div",{class:"flex gap-3 pt-4"},[e("button",{class:"flex-1 bg-slate-100 text-slate-600 font-bold rounded-xl py-3 active:scale-95 transition-all",onClick:_}," Cancel "),e("button",{class:"flex-1 bg-slate-800 text-white font-bold rounded-xl py-3 shadow-lg active:scale-95 transition-all",onClick:g}," Save ")])])])):m("",!0)}},ae={class:"space-y-4"},ne={class:"flex flex-col gap-1"},ie=["disabled"],de={class:"grid grid-cols-2 gap-4 items-end"},ce={class:"flex flex-col gap-1"},ue=["disabled"],fe={class:"flex flex-col gap-1"},pe={class:"flex items-center justify-between bg-slate-50 p-1.5 rounded-xl border border-slate-100"},xe=["disabled"],be={class:"text-lg font-black text-slate-800"},me=["disabled"],ve={key:0,class:"text-xs font-bold text-slate-400 uppercase tracking-wide"},ge={key:1,class:"text-sm font-bold text-rose-600"},he={class:"flex gap-3 pt-4"},_e=["disabled"],ye=["disabled"],we={__name:"EditPreOrderCustomer",props:{open:Boolean,preOrder:{type:Object,required:!0}},emits:["close","saved"],setup(t,{emit:s}){const r=t,a=s,c=M(),h=k(""),_=k(""),g=k(1),x=k(!1),i=k(null),p=q(()=>r.preOrder.status==="OPEN");U(()=>r.preOrder,y=>{y&&(h.value="",_.value="",g.value=1)},{immediate:!0});function j(){a("close")}function A(y){if(!p.value||x.value)return;const n=g.value+y;n>=1&&(g.value=n)}async function D(){if(p.value){i.value=null,x.value=!0;try{await c.addCustomer({pre_order_id:r.preOrder.id,name:h.value.trim(),phone:_.value.trim(),qty:g.value}),a("saved"),a("close")}catch(y){i.value=y?.message||"Failed to save customer"}finally{x.value=!1}}}return(y,n)=>t.open?(f(),u("div",{key:0,class:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:j},[e("div",{class:"absolute bottom-0 w-full bg-white rounded-t-3xl p-5 pb-24 space-y-4 shadow-2xl",onClick:n[4]||(n[4]=P(()=>{},["stop"]))},[n[10]||(n[10]=e("div",{class:"flex justify-between items-center border-b pb-2"},[e("h3",{class:"text-lg font-bold text-slate-800"}," Add Customer ")],-1)),e("div",ae,[e("div",ne,[n[5]||(n[5]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Customer Name ",-1)),$(e("input",{"onUpdate:modelValue":n[0]||(n[0]=C=>h.value=C),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400",placeholder:"e.g. John Tan",disabled:!p.value||x.value},null,8,ie),[[N,h.value]])]),e("div",de,[e("div",ce,[n[6]||(n[6]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Phone Number ",-1)),$(e("input",{"onUpdate:modelValue":n[1]||(n[1]=C=>_.value=C),type:"tel",class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400",placeholder:"e.g. 012345...",disabled:!p.value||x.value},null,8,ue),[[N,_.value]])]),e("div",fe,[n[9]||(n[9]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Quantity ",-1)),e("div",pe,[e("button",{type:"button",class:"w-9 h-9 flex items-center justify-center rounded-lg bg-white border border-slate-200 shadow-sm active:scale-90 disabled:opacity-50",onClick:n[2]||(n[2]=C=>A(-1)),disabled:g.value<=1||!p.value||x.value},[...n[7]||(n[7]=[e("span",{class:"text-lg font-bold text-slate-600"},"âˆ’",-1)])],8,xe),e("span",be,b(g.value),1),e("button",{type:"button",class:"w-9 h-9 flex items-center justify-center rounded-lg bg-slate-800 text-white shadow-md active:scale-90 disabled:opacity-50",onClick:n[3]||(n[3]=C=>A(1)),disabled:!p.value||x.value},[...n[8]||(n[8]=[e("span",{class:"text-lg font-bold"},"+",-1)])],8,me)])])]),p.value?m("",!0):(f(),u("p",ve," Customer can only be edited while status is OPEN ")),i.value?(f(),u("p",ge,b(i.value),1)):m("",!0)]),e("div",he,[e("button",{class:"flex-1 bg-slate-100 text-slate-600 font-bold rounded-xl py-3 active:scale-95 transition-all",onClick:j,disabled:x.value}," Cancel ",8,_e),e("button",{class:"flex-1 bg-slate-800 text-white font-bold rounded-xl py-3 shadow-lg active:scale-95 transition-all disabled:bg-slate-400",onClick:D,disabled:x.value||!p.value},b(x.value?"Saving...":"Save"),9,ye)])])])):m("",!0)}},ke={class:"p-4 pb-24 space-y-3 bg-slate-50 min-h-screen font-sans"},Ce={key:0,class:"text-center py-20 text-slate-400"},Oe={class:"bg-white rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden h-28 flex z-20"},Pe=["onClick"],Ee={class:"space-y-1"},$e={class:"font-black text-slate-800 leading-tight truncate w-48 text-base"},Ne={class:"text-[10px] text-slate-400 font-bold uppercase tracking-wide"},je={class:"flex gap-1.5 mt-2"},Ae={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-red-200 text-slate-600"},De={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-slate-100 text-slate-600"},Ie=["onClick"],ze={class:"absolute right-0 top-0 bottom-0 z-10 flex h-full bg-slate-50"},Se=["onClick"],Fe=["onClick"],Le=["onClick"],Te=["onClick"],Ve={key:0,class:"bg-white/60 border-x border-b border-slate-100 rounded-b-2xl -mt-4 pt-6 p-4 space-y-3 z-10 shadow-inner"},Be={key:0,class:"flex items-center justify-center py-4 gap-2"},Ue={key:1,class:"space-y-2"},qe={class:"flex gap-3 items-center"},Me={class:"h-6 w-6 flex items-center justify-center bg-slate-100 rounded-lg font-black text-slate-700"},Qe={class:"flex flex-col"},Re={class:"font-bold text-slate-800"},Ze={class:"text-[10px] text-slate-400"},Ge=["onClick"],Ke={class:"pt-2 border-t border-dashed border-slate-200 flex justify-between items-center px-1"},Xe={class:"text-[10px] font-bold text-slate-400 uppercase"},Je={class:"text-xs font-black text-slate-800"},He={key:2,class:"text-center py-2 text-[10px] font-bold text-slate-400 uppercase"},et={__name:"PreOrderList",setup(t){const s=M(),r=k(null),a=k(!1),c=k(!1);G(()=>{s.fetchPreOrders()});function h(l){if(l._showActions){l._showActions=!1;return}l._expanded=!l._expanded,l._expanded&&(!l.customers||l.customers.length===0)&&s.fetchPreOrderDetails(l.id)}function _(l){l._showActions||(l._expanded=!1),s.items.forEach(d=>{d.id!==l.id&&(d._showActions=!1)}),l._showActions=!l._showActions}function g(l){return l.status==="OPEN"||l.status==="FINALIZED"}function x(l){return l.status==="OPEN"?192:l.status==="FINALIZED"?64:0}function i(l){return(l.customers||[]).reduce((d,o)=>d+o.qty,0)}function p(l){return l==="OPEN"?"bg-amber-100 text-amber-700":l==="FINALIZED"?"bg-sky-100 text-sky-700":"bg-emerald-100 text-emerald-700"}function j(){r.value=null,a.value=!0}function A(l){r.value=l,a.value=!0}function D(l){r.value=l,c.value=!0}function y(l){confirm("Finalize this pre-order?")&&s.finalize(l)}function n(l){confirm("Mark this pre-order as received?")&&s.received(l)}function C(l,d){confirm("Remove this customer?")&&s.removeCustomer(l.id,d.id)}function I(){a.value=!1,c.value=!1,r.value=null}function S(){s.fetchPreOrders(),I()}function Q(l){if(!l)return"";const d=new Date(l);return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(d)}return(l,d)=>(f(),u(z,null,[e("div",ke,[e("div",{class:"flex justify-between items-center mb-2"},[d[1]||(d[1]=e("h2",{class:"text-xl font-black text-slate-800 tracking-tight"},"Pre-Orders",-1)),e("button",{class:"w-10 h-10 flex items-center justify-center rounded-xl bg-slate-800 text-white shadow-sm active:scale-90 transition-all",onClick:j},[...d[0]||(d[0]=[e("span",{class:"text-xl"},"+",-1)])])]),T(s).loading?(f(),u("div",Ce,[...d[2]||(d[2]=[e("div",{class:"animate-spin inline-block w-8 h-8 border-4 border-slate-300 border-t-slate-800 rounded-full mb-4"},null,-1),e("p",{class:"font-bold text-sm"},"Synchronizing Pre-Orders...",-1)])])):m("",!0),(f(!0),u(z,null,V(T(s).items,o=>(f(),u("div",{key:o.id,class:"flex flex-col mb-4"},[e("div",Oe,[e("div",{class:"absolute inset-0 z-20 bg-white p-4 flex justify-between items-center transition-transform duration-300 ease-out",style:K({transform:o._showActions?`translateX(-${x(o)}px)`:"translateX(0)"}),onClick:v=>h(o)},[e("div",Ee,[e("div",$e,b(o.name),1),e("div",Ne,b(o.sku),1),e("div",je,[e("span",{class:B(["text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg",p(o.status)])},b(o.status),3),e("span",Ae," ðŸ“… "+b(Q(o.last_open_date)),1),e("span",De," Qty : "+b(i(o)),1)])]),g(o)?(f(),u("button",{key:0,onClick:P(v=>_(o),["stop"]),class:"w-12 h-12 flex items-center justify-center text-slate-300 active:text-blue-500 transition-colors"},[e("i",{class:B(["fa text-2xl transition-transform duration-300",o._showActions?"fa-chevron-right":"fa-chevron-left"])},null,2)],8,Ie)):m("",!0)],12,Pe),e("div",ze,[o.status==="OPEN"?(f(),u("button",{key:0,class:"w-16 bg-sky-500 text-white flex flex-col items-center justify-center gap-1",onClick:P(v=>A(o),["stop"])},[...d[3]||(d[3]=[e("i",{class:"fa fa-pencil text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Edit",-1)])],8,Se)):m("",!0),o.status==="OPEN"?(f(),u("button",{key:1,class:"w-16 bg-amber-400 text-amber-900 flex flex-col items-center justify-center gap-1",onClick:P(v=>D(o),["stop"])},[...d[4]||(d[4]=[e("i",{class:"fa fa-user-plus text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Add",-1)])],8,Fe)):m("",!0),o.status==="OPEN"?(f(),u("button",{key:2,class:"w-16 bg-slate-800 text-white flex flex-col items-center justify-center gap-1",onClick:P(v=>y(o),["stop"])},[...d[5]||(d[5]=[e("i",{class:"fa fa-lock text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Finalize",-1)])],8,Le)):m("",!0),o.status==="FINALIZED"?(f(),u("button",{key:3,class:"w-16 bg-emerald-500 text-white flex flex-col items-center justify-center gap-1",onClick:P(v=>n(o),["stop"])},[...d[6]||(d[6]=[e("i",{class:"fa fa-check-circle text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Received",-1)])],8,Te)):m("",!0)])]),o._expanded?(f(),u("div",Ve,[o._loadingItems?(f(),u("div",Be,[...d[7]||(d[7]=[e("div",{class:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"},null,-1),e("span",{class:"text-[11px] font-bold text-slate-400 uppercase tracking-widest"},"Fetching Details",-1)])])):o.customers&&o.customers.length?(f(),u("div",Ue,[(f(!0),u(z,null,V(o.customers,v=>(f(),u("div",{key:v.id,class:"flex justify-between items-center text-xs bg-white p-2 rounded-xl border border-slate-50 shadow-sm"},[e("div",qe,[e("span",Me,b(v.qty),1),e("div",Qe,[e("span",Re,b(v.name),1),e("span",Ze,b(v.phone||""),1)])]),o.status==="OPEN"?(f(),u("button",{key:0,class:"text-rose-500 text-xs font-bold active:opacity-50",onClick:We=>C(o,v)}," Delete ",8,Ge)):m("",!0)]))),128)),e("div",Ke,[e("span",Xe,"Total Customers: "+b(o.customers.length),1),e("span",Je,"Qty "+b(i(o)),1)])])):(f(),u("div",He," No customers "))])):m("",!0)]))),128))]),L(re,{open:a.value,preOrder:r.value,onClose:I,onSave:S},null,8,["open","preOrder"]),L(we,{open:c.value,preOrder:r.value,onClose:I,onSaved:S},null,8,["open","preOrder"])],64))}};export{et as default};
