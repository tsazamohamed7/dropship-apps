import{z as E,a as B,d as K,p as $,f as q,w as S,r as y,i as G,A as X,e as F,c as p,j as b,o as f,b as e,t as m,k as N,B as J,F as I,q as T,v as D,l as A,C as V,u as U,y as H,n as M}from"./index-BpMlzn1i.js";import{u as W}from"./product.store-DpFMZ5aC.js";const O={getAll(){return B({resource:"preorder"})},getById(t){return B({resource:"preorder",id:t})},createProduct(t){return E({resource:"preorder",method:"POST",...t})},update(t){return E({resource:"preorder",method:"PUT",...t})},deleteProduct(t){return E({resource:"preorder",method:"DELETE",preorder_id:t})},addCustomer(t){return E({resource:"preorder",method:"ADD_ITEM",...t})},removeCustomer(t){return E({resource:"preorder",method:"DELETE_ITEM",preorder_item_id:t})},finalize(t){return E({resource:"preorder",method:"FINALIZE",preorder_id:t})},received(t){return E({resource:"preorder",method:"RECEIVE",preorder_id:t})}},Q=K("preOrder",{state:()=>({items:[],loading:!1}),actions:{async fetchPreOrders(){this.loading=!0;try{const t=await O.getAll();this.items=(t.data||[]).map(l=>({...l,id:l.preorder_id,customers:l.customers||[],_expanded:!1,_showActions:!1}))}finally{this.loading=!1}},async fetchPreOrderDetails(t){const l=this.items.find(r=>r.id===t);if(l){l._loadingItems=!0;try{const r=await O.getById(t);r.data&&(l.customers=(r.data.items||[]).map(a=>({id:a.preorder_item_id,name:a.customer_name,phone:a.phone,qty:a.qty})),l.status=r.data.status)}catch(r){console.error("Fetch pre-order details failed",r)}finally{l._loadingItems=!1}}},async createPreOrder(t){const l=$();l.info("Creating pre-order..."),await O.createProduct(t),await this.fetchPreOrders(),l.success("Pre-order product created")},async addCustomer(t){const l=$(),{pre_order_id:r}=t,a=this.items.find(x=>x.id===r);if(!a||a.status!=="OPEN"){l.error("Pre-order is not editable");return}await O.addCustomer(t),await this.fetchPreOrderDetails(r),l.success("Customer added")},async removeCustomer(t,l){const r=$(),a=this.items.find(x=>x.id===t);!a||a.status!=="OPEN"||(await O.removeCustomer(l),a.customers=a.customers.filter(x=>x.id!==l),r.success("Customer removed"))},async deletePreOrder(t){const l=$(),r=this.items.find(a=>a.id===t);if(r){if(r.status!=="OPEN"||r.customers.length>0){l.error("Cannot delete this pre-order");return}await O.deleteProduct(t),this.items=this.items.filter(a=>a.id!==t),l.success("Pre-order deleted")}},async updatePreOrder(t){const l=$();try{l.info("Updating pre-order..."),await O.update(t),await this.fetchPreOrders(),l.success("Pre-order updated")}catch(r){throw l.error("Failed to update pre-order"),r}},async finalize(t){const l=$();await O.finalize(t.id),t.status="FINALIZED",l.success("Pre-order finalized")},async received(t){const l=$();await O.received(t.id),t.status="RECEIVED",l.success("Marked as received")}}}),Y={class:"flex justify-between items-center border-b pb-2"},ee={class:"text-lg font-bold text-slate-800"},te={class:"space-y-4"},se={class:"flex flex-col gap-2"},le=["value"],oe={key:0,class:"flex flex-col gap-1"},re={class:"flex flex-col gap-1"},ae={class:"grid grid-cols-2 gap-4"},ne={class:"flex flex-col gap-1"},de=["disabled"],ie={class:"flex flex-col gap-1"},ue=["disabled"],ce={__name:"EditPreOrderProduct",props:{open:Boolean,preOrder:Object},emits:["close","save"],setup(t,{emit:l}){const r=W(),a=y(""),x=y(!1);q(async()=>{await r.fetchSimpleProducts()});const _=F(()=>r.simpleItems),w=t,g=l,i=G({preorder_id:"",product_id:"",name:"",sku:"",last_open_date:"",expected_receive_date:"",status:"OPEN"}),P=F(()=>i.status==="OPEN");S(()=>w.open,k=>{if(k){if(x.value=!0,w.preOrder){const o={...w.preOrder},u=d=>d?d.split("T")[0]:"";o.last_open_date=u(o.last_open_date),o.expected_receive_date=u(o.expected_receive_date),Object.assign(i,o),a.value=o.product_id||""}else Object.assign(i,{preorder_id:"",product_id:"",name:"",sku:"",last_open_date:"",expected_receive_date:"",status:"OPEN"}),a.value="";X(()=>{x.value=!1})}},{immediate:!0}),S(a,k=>{if(!x.value&&k){const o=_.value.find(u=>u.product_id===k);if(!o)return;i.product_id=o.product_id,i.name=o.name,i.sku=o.sku;return}});function v(){g("close")}function j(){g("save",{...i,isNewProduct:!a.value})}return(k,o)=>t.open?(f(),p("div",{key:0,class:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:v},[e("div",{class:"absolute bottom-0 w-full bg-white rounded-t-3xl p-5 pb-24 space-y-4 shadow-2xl",onClick:o[5]||(o[5]=A(()=>{},["stop"]))},[e("div",Y,[e("h3",ee,m(t.preOrder?"Edit Pre-Order Product":"Add Pre-Order Product"),1)]),e("div",te,[e("div",se,[o[7]||(o[7]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Product ",-1)),N(e("select",{"onUpdate:modelValue":o[0]||(o[0]=u=>a.value=u),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none"},[o[6]||(o[6]=e("option",{value:""},"-- Create New Product --",-1)),(f(!0),p(I,null,T(_.value,u=>(f(),p("option",{key:u.product_id,value:u.product_id},m(u.name),9,le))),128))],512),[[J,a.value]])]),a.value?b("",!0):(f(),p("div",oe,[o[8]||(o[8]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," New Product Name ",-1)),N(e("input",{"onUpdate:modelValue":o[1]||(o[1]=u=>i.name=u),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"e.g. Kuih Muih"},null,512),[[D,i.name]])])),e("div",re,[o[9]||(o[9]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," SKU ",-1)),N(e("input",{"onUpdate:modelValue":o[2]||(o[2]=u=>i.sku=u),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"IP16-PRO-BLK"},null,512),[[D,i.sku]])]),e("div",ae,[e("div",ne,[o[10]||(o[10]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Last Open Date ",-1)),N(e("input",{"onUpdate:modelValue":o[3]||(o[3]=u=>i.last_open_date=u),type:"date",disabled:!P.value,class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400"},null,8,de),[[D,i.last_open_date]])]),e("div",ie,[o[11]||(o[11]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Expected Receive Date ",-1)),N(e("input",{"onUpdate:modelValue":o[4]||(o[4]=u=>i.expected_receive_date=u),type:"date",disabled:!P.value,class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400"},null,8,ue),[[D,i.expected_receive_date]])])])]),e("div",{class:"flex gap-3 pt-4"},[e("button",{class:"flex-1 bg-slate-100 text-slate-600 font-bold rounded-xl py-3 active:scale-95 transition-all",onClick:v}," Cancel "),e("button",{class:"flex-1 bg-slate-800 text-white font-bold rounded-xl py-3 shadow-lg active:scale-95 transition-all",onClick:j}," Save ")])])])):b("",!0)}},fe={class:"space-y-4"},pe={class:"flex flex-col gap-1"},xe=["disabled"],be={class:"grid grid-cols-2 gap-4 items-end"},me={class:"flex flex-col gap-1"},ve=["disabled"],_e={class:"flex flex-col gap-1"},ge={class:"flex items-center justify-between bg-slate-50 p-1.5 rounded-xl border border-slate-100"},he=["disabled"],ye={class:"text-lg font-black text-slate-800"},we=["disabled"],ke={key:0,class:"text-xs font-bold text-slate-400 uppercase tracking-wide"},Pe={key:1,class:"text-sm font-bold text-rose-600"},Oe={class:"flex gap-3 pt-4"},Ce=["disabled"],Ee=["disabled"],$e={__name:"EditPreOrderCustomer",props:{open:Boolean,preOrder:{type:Object,required:!1,default:null}},emits:["close","saved"],setup(t,{emit:l}){const r=t,a=l,x=Q(),_=y(""),w=y(""),g=y(1),i=y(!1),P=y(null),v=F(()=>r.preOrder?.status==="OPEN");S(()=>r.preOrder,u=>{u&&(_.value="",w.value="",g.value=1)},{immediate:!0});function j(){a("close")}function k(u){if(!v.value||i.value)return;const d=g.value+u;d>=1&&(g.value=d)}async function o(){if(v.value){P.value=null,i.value=!0;try{await x.addCustomer({pre_order_id:r.preOrder.id,name:_.value.trim(),phone:w.value.trim(),qty:g.value}),a("saved"),a("close")}catch(u){P.value=u?.message||"Failed to save customer"}finally{i.value=!1}}}return(u,d)=>t.open?(f(),p("div",{key:0,class:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:j},[e("div",{class:"absolute bottom-0 w-full bg-white rounded-t-3xl p-5 pb-24 space-y-4 shadow-2xl",onClick:d[4]||(d[4]=A(()=>{},["stop"]))},[d[10]||(d[10]=e("div",{class:"flex justify-between items-center border-b pb-2"},[e("h3",{class:"text-lg font-bold text-slate-800"}," Add Customer ")],-1)),e("div",fe,[e("div",pe,[d[5]||(d[5]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Customer Name ",-1)),N(e("input",{"onUpdate:modelValue":d[0]||(d[0]=C=>_.value=C),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400",placeholder:"e.g. John Tan",disabled:!v.value||i.value},null,8,xe),[[D,_.value]])]),e("div",be,[e("div",me,[d[6]||(d[6]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Phone Number ",-1)),N(e("input",{"onUpdate:modelValue":d[1]||(d[1]=C=>w.value=C),type:"tel",class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400",placeholder:"e.g. 012345...",disabled:!v.value||i.value},null,8,ve),[[D,w.value]])]),e("div",_e,[d[9]||(d[9]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Quantity ",-1)),e("div",ge,[e("button",{type:"button",class:"w-9 h-9 flex items-center justify-center rounded-lg bg-white border border-slate-200 shadow-sm active:scale-90 disabled:opacity-50",onClick:d[2]||(d[2]=C=>k(-1)),disabled:g.value<=1||!v.value||i.value},[...d[7]||(d[7]=[e("span",{class:"text-lg font-bold text-slate-600"},"âˆ’",-1)])],8,he),e("span",ye,m(g.value),1),e("button",{type:"button",class:"w-9 h-9 flex items-center justify-center rounded-lg bg-slate-800 text-white shadow-md active:scale-90 disabled:opacity-50",onClick:d[3]||(d[3]=C=>k(1)),disabled:!v.value||i.value},[...d[8]||(d[8]=[e("span",{class:"text-lg font-bold"},"+",-1)])],8,we)])])]),v.value?b("",!0):(f(),p("p",ke," Customer can only be edited while status is OPEN ")),P.value?(f(),p("p",Pe,m(P.value),1)):b("",!0)]),e("div",Oe,[e("button",{class:"flex-1 bg-slate-100 text-slate-600 font-bold rounded-xl py-3 active:scale-95 transition-all",onClick:j,disabled:i.value}," Cancel ",8,Ce),e("button",{class:"flex-1 bg-slate-800 text-white font-bold rounded-xl py-3 shadow-lg active:scale-95 transition-all disabled:bg-slate-400",onClick:o,disabled:i.value||!v.value},m(i.value?"Saving...":"Save"),9,Ee)])])])):b("",!0)}},Ne={class:"p-4 pb-24 space-y-3 bg-slate-50 min-h-screen font-sans"},Ae={key:0,class:"text-center py-20 text-slate-400"},je={class:"bg-white rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden h-28 flex z-20"},De=["onClick"],Ie={class:"space-y-1"},ze={class:"font-black text-slate-800 leading-tight truncate w-48 text-base"},Se={class:"text-[10px] text-slate-400 font-bold uppercase tracking-wide"},Fe={class:"flex gap-1.5 mt-2"},Te={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-red-200 text-slate-600"},Le={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-slate-100 text-slate-600"},Be=["onClick"],Ve={class:"absolute right-0 top-0 bottom-0 z-10 flex h-full bg-slate-50"},Ue=["onClick"],Me=["onClick"],qe=["onClick"],Qe=["onClick"],Re={key:0,class:"bg-white/60 border-x border-b border-slate-100 rounded-b-2xl -mt-4 pt-6 p-4 space-y-3 z-10 shadow-inner"},Ze={key:0,class:"flex items-center justify-center py-4 gap-2"},Ke={key:1,class:"space-y-2"},Ge={class:"flex gap-3 items-center"},Xe={class:"h-6 w-6 flex items-center justify-center bg-slate-100 rounded-lg font-black text-slate-700"},Je={class:"flex flex-col"},He={class:"font-bold text-slate-800"},We={class:"text-[10px] text-slate-400"},Ye=["onClick"],et={class:"pt-2 border-t border-dashed border-slate-200 flex justify-between items-center px-1"},tt={class:"text-[10px] font-bold text-slate-400 uppercase"},st={class:"text-xs font-black text-slate-800"},lt={key:2,class:"text-center py-2 text-[10px] font-bold text-slate-400 uppercase"},nt={__name:"PreOrderList",setup(t){const l=Q(),r=y(null),a=y(null),x=y(!1),_=y(!1);q(()=>{l.fetchPreOrders()});function w(s){if(s._showActions){s._showActions=!1;return}s._expanded=!s._expanded,s._expanded&&(!s.customers||s.customers.length===0)&&l.fetchPreOrderDetails(s.id)}function g(s){s._showActions||(s._expanded=!1),l.items.forEach(c=>{c.id!==s.id&&(c._showActions=!1)}),s._showActions=!s._showActions}function i(s){return s.status==="OPEN"||s.status==="FINALIZED"}function P(s){return s.status==="OPEN"?192:s.status==="FINALIZED"?64:0}function v(s){return(s.customers||[]).reduce((c,n)=>c+n.qty,0)}function j(s){return s==="OPEN"?"bg-amber-100 text-amber-700":s==="FINALIZED"?"bg-sky-100 text-sky-700":"bg-emerald-100 text-emerald-700"}function k(){a.value=null,r.value=null,x.value=!0}function o(s){a.value=s,s._showActions=!1,r.value=s,x.value=!0}function u(s){s._showActions=!1,r.value=s,_.value=!0}function d(s){confirm("Finalize this pre-order?")&&(s._showActions=!1,l.finalize(s))}function C(s){confirm("Mark this pre-order as received?")&&(s._showActions=!1,l.received(s))}function R(s,c){confirm("Remove this customer?")&&l.removeCustomer(s.id,c.id)}function z(){x.value=!1,_.value=!1,r.value=null}async function L(s){a.value?l.updatePreOrder(s):l.createPreOrder(s),z()}function Z(s){if(!s)return"";const c=new Date(s);return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(c)}return(s,c)=>(f(),p(I,null,[e("div",Ne,[e("div",{class:"flex justify-between items-center mb-2"},[c[1]||(c[1]=e("h2",{class:"text-xl font-black text-slate-800 tracking-tight"},"Pre-Orders",-1)),e("button",{class:"w-10 h-10 flex items-center justify-center rounded-xl bg-slate-800 text-white shadow-sm active:scale-90 transition-all",onClick:k},[...c[0]||(c[0]=[e("span",{class:"text-xl"},"+",-1)])])]),U(l).loading?(f(),p("div",Ae,[...c[2]||(c[2]=[e("div",{class:"animate-spin inline-block w-8 h-8 border-4 border-slate-300 border-t-slate-800 rounded-full mb-4"},null,-1),e("p",{class:"font-bold text-sm"},"Synchronizing Pre-Orders...",-1)])])):b("",!0),(f(!0),p(I,null,T(U(l).items,n=>(f(),p("div",{key:n.id,class:"flex flex-col mb-4"},[e("div",je,[e("div",{class:"absolute inset-0 z-20 bg-white p-4 flex justify-between items-center transition-transform duration-300 ease-out",style:H({transform:n._showActions?`translateX(-${P(n)}px)`:"translateX(0)"}),onClick:h=>w(n)},[e("div",Ie,[e("div",ze,m(n.name),1),e("div",Se,m(n.sku),1),e("div",Fe,[e("span",{class:M(["text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg",j(n.status)])},m(n.status),3),e("span",Te," ðŸ“… "+m(Z(n.last_open_date)),1),e("span",Le," Qty : "+m(v(n)),1)])]),i(n)?(f(),p("button",{key:0,onClick:A(h=>g(n),["stop"]),class:"w-12 h-12 flex items-center justify-center text-slate-300 active:text-blue-500 transition-colors"},[e("i",{class:M(["fa text-2xl transition-transform duration-300",n._showActions?"fa-chevron-right":"fa-chevron-left"])},null,2)],8,Be)):b("",!0)],12,De),e("div",Ve,[n.status==="OPEN"?(f(),p("button",{key:0,class:"w-16 bg-sky-500 text-white flex flex-col items-center justify-center gap-1",onClick:A(h=>o(n),["stop"])},[...c[3]||(c[3]=[e("i",{class:"fa fa-pencil text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Edit",-1)])],8,Ue)):b("",!0),n.status==="OPEN"?(f(),p("button",{key:1,class:"w-16 bg-amber-400 text-amber-900 flex flex-col items-center justify-center gap-1",onClick:A(h=>u(n),["stop"])},[...c[4]||(c[4]=[e("i",{class:"fa fa-user-plus text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Add",-1)])],8,Me)):b("",!0),n.status==="OPEN"?(f(),p("button",{key:2,class:"w-16 bg-slate-800 text-white flex flex-col items-center justify-center gap-1",onClick:A(h=>d(n),["stop"])},[...c[5]||(c[5]=[e("i",{class:"fa fa-lock text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Finalize",-1)])],8,qe)):b("",!0),n.status==="FINALIZED"?(f(),p("button",{key:3,class:"w-16 bg-emerald-500 text-white flex flex-col items-center justify-center gap-1",onClick:A(h=>C(n),["stop"])},[...c[6]||(c[6]=[e("i",{class:"fa fa-check-circle text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Received",-1)])],8,Qe)):b("",!0)])]),n._expanded?(f(),p("div",Re,[n._loadingItems?(f(),p("div",Ze,[...c[7]||(c[7]=[e("div",{class:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"},null,-1),e("span",{class:"text-[11px] font-bold text-slate-400 uppercase tracking-widest"},"Fetching Details",-1)])])):n.customers&&n.customers.length?(f(),p("div",Ke,[(f(!0),p(I,null,T(n.customers,h=>(f(),p("div",{key:h.id,class:"flex justify-between items-center text-xs bg-white p-2 rounded-xl border border-slate-50 shadow-sm"},[e("div",Ge,[e("span",Xe,m(h.qty),1),e("div",Je,[e("span",He,m(h.name),1),e("span",We,m(h.phone||""),1)])]),n.status==="OPEN"?(f(),p("button",{key:0,class:"text-rose-500 text-xs font-bold active:opacity-50",onClick:ot=>R(n,h)}," Delete ",8,Ye)):b("",!0)]))),128)),e("div",et,[e("span",tt,"Total Customers: "+m(n.customers.length),1),e("span",st,"Qty "+m(v(n)),1)])])):(f(),p("div",lt," No customers "))])):b("",!0)]))),128))]),x.value?(f(),V(ce,{key:0,open:x.value,preOrder:r.value,onClose:z,onSave:L},null,8,["open","preOrder"])):b("",!0),_.value&&r.value?(f(),V($e,{key:1,open:_.value,preOrder:r.value,onClose:z,onSaved:L},null,8,["open","preOrder"])):b("",!0)],64))}};export{nt as default};
