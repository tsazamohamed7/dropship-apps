import{i as h,a as y,d as z,j as p,f as D,c as n,b as r,l as f,t as u,u as _,F as k,s as v,o as i,z as j,n as w,p as b}from"./index-DF2tDzGh.js";const x={getAll(){return y({resource:"preorder"})},getById(e){return y({resource:"preorder",id:e})},create(e){return h({resource:"preorder",method:"POST",...e})},update(e){return h({resource:"preorder",method:"PUT",...e})},delete(e){return h({resource:"preorder",method:"DELETE",preorder_id:e})},addItem(e){return h({resource:"preorder",method:"ADD_ITEM",...e})},deleteItem(e){return h({resource:"preorder",method:"DELETE_ITEM",preorder_item_id:e})},finalize(e){return h({resource:"preorder",method:"FINALIZE",preorder_id:e})},receive(e){return h({resource:"preorder",method:"RECEIVE",preorder_id:e})}},F=z("preOrder",{state:()=>({items:[],loading:!1}),actions:{async fetchPreOrders(){this.loading=!0;try{const e=await x.getAll();this.items=(e.data||[]).map(s=>({...s,customers:s.customers||[],_expanded:!1,_showActions:!1}))}finally{this.loading=!1}},async fetchPreOrderDetails(e){const s=this.items.find(l=>l.id===e);if(s){s._loadingItems=!0;try{const l=await x.getById(e);l.data&&(s.customers=l.data.customers||[],s.status=l.data.status)}finally{s._loadingItems=!1}}},async createPreOrder(e){const s=p();s.info("Creating pre-order..."),await x.createProduct(e),await this.fetchPreOrders(),s.success("Pre-order product created")},async addCustomer(e,s){const l=p(),c=this.items.find(m=>m.id===e);!c||c.status!=="OPEN"||(await x.addCustomer(e,s),await this.fetchPreOrders(),l.success("Customer added"))},async removeCustomer(e,s){const l=p(),c=this.items.find(m=>m.id===e);!c||c.status!=="OPEN"||(await x.removeCustomer(s),c.customers=c.customers.filter(m=>m.id!==s),l.success("Customer removed"))},async deletePreOrder(e){const s=p(),l=this.items.find(c=>c.id===e);if(l){if(l.status!=="OPEN"||l.customers.length>0){s.error("Cannot delete this pre-order");return}await x.deleteProduct(e),this.items=this.items.filter(c=>c.id!==e),s.success("Pre-order deleted")}},async finalize(e){const s=p();await x.finalize(e.id),e.status="FINALIZED",s.success("Pre-order finalized")},async received(e){const s=p();await x.received(e.id),e.status="RECEIVED",s.success("Marked as received")}}}),L={class:"p-4 pb-24 space-y-3 bg-slate-50 min-h-screen font-sans"},S={class:"flex justify-between items-center mb-2"},T={class:"text-[10px] bg-slate-200 px-2 py-1 rounded-lg font-bold text-slate-500 uppercase"},$={key:0,class:"text-center py-20 text-slate-400"},M={class:"bg-white rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden h-28 flex z-20"},Z=["onClick"],B={class:"space-y-1"},R={class:"font-black text-slate-800 leading-tight truncate w-48 text-base"},V={class:"text-[10px] text-slate-400 font-bold uppercase tracking-wide"},Q={class:"flex gap-1.5 mt-2"},q={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-slate-100 text-slate-600"},X=["onClick"],G={class:"absolute right-0 top-0 bottom-0 z-10 flex h-full bg-slate-50"},U=["onClick"],H=["onClick"],J=["onClick"],K=["onClick"],W={key:0,class:"bg-white/60 border-x border-b border-slate-100 rounded-b-2xl -mt-4 pt-6 p-4 space-y-3 z-10 shadow-inner"},Y={key:0,class:"flex items-center justify-center py-4 gap-2"},ee={key:1,class:"space-y-2"},te={class:"flex gap-3 items-center"},se={class:"h-6 w-6 flex items-center justify-center bg-slate-100 rounded-lg font-black text-slate-700"},re={class:"flex flex-col"},oe={class:"font-bold text-slate-800"},ae={class:"text-[10px] text-slate-400"},ne=["onClick"],ie={class:"pt-2 border-t border-dashed border-slate-200 flex justify-between items-center px-1"},le={class:"text-[10px] font-bold text-slate-400 uppercase"},ce={class:"text-xs font-black text-slate-800"},de={key:2,class:"text-center py-2 text-[10px] font-bold text-slate-400 uppercase"},xe={__name:"PreOrderList",setup(e){const s=F();D(()=>{s.fetchPreOrders()});function l(t){if(t._showActions){t._showActions=!1;return}t._expanded=!t._expanded,t._expanded&&(!t.customers||t.customers.length===0)&&s.fetchPreOrderDetails(t.id)}function c(t){t._showActions||(t._expanded=!1),s.items.forEach(a=>{a.id!==t.id&&(a._showActions=!1)}),t._showActions=!t._showActions}function m(t){return t.status==="OPEN"||t.status==="FINALIZED"}function E(t){return t.status==="OPEN"?192:t.status==="FINALIZED"?64:0}function g(t){return(t.customers||[]).reduce((a,o)=>a+o.qty,0)}function C(t){return t==="OPEN"?"bg-amber-100 text-amber-700":t==="FINALIZED"?"bg-sky-100 text-sky-700":"bg-emerald-100 text-emerald-700"}function P(t){alert("Edit pre-order product (modal next)")}function O(t){alert("Add customer modal next")}function A(t){confirm("Finalize this pre-order?")&&s.finalize(t)}function I(t){confirm("Mark this pre-order as received?")&&s.received(t)}function N(t,a){confirm("Remove this customer?")&&s.removeCustomer(t.id,a.id)}return(t,a)=>(i(),n("div",L,[r("div",S,[a[0]||(a[0]=r("h2",{class:"text-xl font-black text-slate-800 tracking-tight"},"Pre-Orders",-1)),r("span",T,u(_(s).items.length)+" Items ",1)]),_(s).loading?(i(),n("div",$,[...a[1]||(a[1]=[r("div",{class:"animate-spin inline-block w-8 h-8 border-4 border-slate-300 border-t-slate-800 rounded-full mb-4"},null,-1),r("p",{class:"font-bold text-sm"},"Synchronizing Pre-Orders...",-1)])])):f("",!0),(i(!0),n(k,null,v(_(s).items,o=>(i(),n("div",{key:o.id,class:"flex flex-col mb-4"},[r("div",M,[r("div",{class:"absolute inset-0 z-20 bg-white p-4 flex justify-between items-center transition-transform duration-300 ease-out",style:j({transform:o._showActions?`translateX(-${E(o)}px)`:"translateX(0)"}),onClick:d=>l(o)},[r("div",B,[r("div",R,u(o.product_name),1),r("div",V,u(o.sku),1),r("div",Q,[r("span",{class:w(["text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg",C(o.status)])},u(o.status),3),r("span",q," Qty "+u(g(o)),1)])]),m(o)?(i(),n("button",{key:0,onClick:b(d=>c(o),["stop"]),class:"w-12 h-12 flex items-center justify-center text-slate-300 active:text-blue-500 transition-colors"},[r("i",{class:w(["fa text-2xl transition-transform duration-300",o._showActions?"fa-chevron-right":"fa-chevron-left"])},null,2)],8,X)):f("",!0)],12,Z),r("div",G,[o.status==="OPEN"?(i(),n("button",{key:0,class:"w-16 bg-sky-500 text-white flex flex-col items-center justify-center gap-1",onClick:b(d=>P(),["stop"])},[...a[2]||(a[2]=[r("i",{class:"fa fa-pencil text-xl"},null,-1),r("span",{class:"text-[9px] font-black uppercase"},"Edit",-1)])],8,U)):f("",!0),o.status==="OPEN"?(i(),n("button",{key:1,class:"w-16 bg-amber-400 text-amber-900 flex flex-col items-center justify-center gap-1",onClick:b(d=>O(),["stop"])},[...a[3]||(a[3]=[r("i",{class:"fa fa-user-plus text-xl"},null,-1),r("span",{class:"text-[9px] font-black uppercase"},"Add",-1)])],8,H)):f("",!0),o.status==="OPEN"?(i(),n("button",{key:2,class:"w-16 bg-slate-800 text-white flex flex-col items-center justify-center gap-1",onClick:b(d=>A(o),["stop"])},[...a[4]||(a[4]=[r("i",{class:"fa fa-lock text-xl"},null,-1),r("span",{class:"text-[9px] font-black uppercase"},"Finalize",-1)])],8,J)):f("",!0),o.status==="FINALIZED"?(i(),n("button",{key:3,class:"w-16 bg-emerald-500 text-white flex flex-col items-center justify-center gap-1",onClick:b(d=>I(o),["stop"])},[...a[5]||(a[5]=[r("i",{class:"fa fa-check-circle text-xl"},null,-1),r("span",{class:"text-[9px] font-black uppercase"},"Received",-1)])],8,K)):f("",!0)])]),o._expanded?(i(),n("div",W,[o._loadingItems?(i(),n("div",Y,[...a[6]||(a[6]=[r("div",{class:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"},null,-1),r("span",{class:"text-[11px] font-bold text-slate-400 uppercase tracking-widest"},"Fetching Details",-1)])])):o.customers&&o.customers.length?(i(),n("div",ee,[(i(!0),n(k,null,v(o.customers,d=>(i(),n("div",{key:d.id,class:"flex justify-between items-center text-xs bg-white p-2 rounded-xl border border-slate-50 shadow-sm"},[r("div",te,[r("span",se,u(d.qty),1),r("div",re,[r("span",oe,u(d.name),1),r("span",ae,u(d.phone),1)])]),o.status==="OPEN"?(i(),n("button",{key:0,class:"text-rose-500 text-xs font-bold",onClick:ue=>N(o,d)}," Delete ",8,ne)):f("",!0)]))),128)),r("div",ie,[r("span",le,"Total Customers: "+u(o.customers.length),1),r("span",ce,"Qty "+u(g(o)),1)])])):(i(),n("div",de," No customers "))])):f("",!0)]))),128))]))}};export{xe as default};
