import{v as $,a as B,d as ee,j as C,p as te,f as q,w as F,r as h,x as se,y as oe,e as T,c as p,k as b,o as f,b as e,t as m,z as N,A as re,F as I,l as L,B as S,s as A,C as z,u as U,q as le,n as V}from"./index-BUliUuHd.js";import{u as M,_ as ae}from"./EditProductSheet-BpweoOOZ.js";const O={getAll(){return B({resource:"preorder"})},getById(s){return B({resource:"preorder",id:s})},createProduct(s){return $({resource:"preorder",method:"POST",...s})},update(s){return $({resource:"preorder",method:"PUT",...s})},deleteProduct(s){return $({resource:"preorder",method:"DELETE",preorder_id:s})},addCustomer(s){return $({resource:"preorder",method:"ADD_ITEM",...s})},removeCustomer(s){return $({resource:"preorder",method:"DELETE_ITEM",preorder_item_id:s})},finalize(s){return $({resource:"preorder",method:"FINALIZE",preorder_product_id:s})},received(s,o){return $({resource:"preorder",method:"RECEIVE",preorder_product_id:s,product_id:o})}},Q=ee("preOrder",{state:()=>({items:[],loading:!1}),actions:{async fetchPreOrders(){this.loading=!0;try{const s=await O.getAll();this.items=(s.data||[]).map(o=>({...o,id:o.preorder_product_id,customers:o.customers||[],_expanded:!1,_showActions:!1}))}finally{this.loading=!1}},async fetchPreOrderDetails(s){const o=this.items.find(d=>d.id===s);if(o){o._loadingItems=!0;try{const d=await O.getById(s);d.data&&(o.customers=(d.data.items||[]).map(i=>({id:i.preorder_item_id,name:i.customer_name,phone:i.phone,qty:i.qty})),o.status=d.data.status)}catch(d){console.error("Fetch pre-order details failed",d)}finally{o._loadingItems=!1}}},async createPreOrder(s){const o=C();o.info("Creating pre-order..."),await O.createProduct(s),await this.fetchPreOrders(),o.success("Pre-order product created")},async addCustomer(s){const o=C(),{pre_order_id:d}=s;this.items.find(i=>i.id===d),await O.addCustomer(s),await this.fetchPreOrderDetails(d),o.success("Customer added")},async removeCustomer(s,o){const d=C(),i=this.items.find(x=>x.id===s);!i||i.status!=="OPEN"||(await O.removeCustomer(o),i.customers=i.customers.filter(x=>x.id!==o),d.success("Customer removed"))},async deletePreOrder(s){const o=C(),d=this.items.find(i=>i.id===s);if(d){if(d.status!=="OPEN"||d.customers.length>0){o.error("Cannot delete this pre-order");return}await O.deleteProduct(s),this.items=this.items.filter(i=>i.id!==s),o.success("Pre-order deleted")}},async updatePreOrder(s){const o=C();try{o.info("Updating pre-order..."),await O.update(s),await this.fetchPreOrders(),o.success("Pre-order updated")}catch(d){throw o.error("Failed to update pre-order"),d}},async finalize(s){const o=C(),d=await O.finalize(s.preorder_product_id);return s.status="FINALIZED",o.success("Pre-order finalized"),d.data},async received(s){const o=C(),d=te();try{await O.received(s.preorder_product_id,s.product_id),await this.fetchPreOrders(),await d.fetchOrders(),o.success("Pre-order received and orders created")}catch(i){o.error(i?.message||"Failed to receive pre-order")}}}}),ne={class:"flex justify-between items-center border-b pb-2"},de={class:"text-lg font-bold text-slate-800"},ie={class:"space-y-4"},ue={class:"flex flex-col gap-2"},ce=["value"],fe={key:0,class:"flex flex-col gap-1"},pe={class:"flex flex-col gap-1"},xe={class:"grid grid-cols-2 gap-4"},be={class:"flex flex-col gap-1"},me=["disabled"],ve={class:"flex flex-col gap-1"},_e=["disabled"],ge={__name:"EditPreOrderProduct",props:{open:Boolean,preOrder:Object},emits:["close","save"],setup(s,{emit:o}){const d=M(),i=h(""),x=h(!1);q(async()=>{await d.fetchSimpleProducts()});const y=T(()=>d.simpleItems),v=s,_=o,a=se({preorder_id:"",product_id:"",name:"",sku:"",last_open_date:"",expected_receive_date:"",status:"OPEN"}),k=T(()=>a.status==="OPEN");F(()=>v.open,P=>{if(P){if(x.value=!0,v.preOrder){const r={...v.preOrder},c=u=>u?u.split("T")[0]:"";r.last_open_date=c(r.last_open_date),r.expected_receive_date=c(r.expected_receive_date),Object.assign(a,r),i.value=r.product_id||""}else Object.assign(a,{preorder_id:"",product_id:"",name:"",sku:"",last_open_date:"",expected_receive_date:"",status:"OPEN"}),i.value="";oe(()=>{x.value=!1})}},{immediate:!0}),F(i,P=>{if(!x.value&&P){const r=y.value.find(c=>c.product_id===P);if(!r)return;a.product_id=r.product_id,a.name=r.name,a.sku=r.sku;return}});function g(){_("close")}function D(){_("save",{...a,isNewProduct:!i.value})}return(P,r)=>s.open?(f(),p("div",{key:0,class:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:g},[e("div",{class:"absolute bottom-0 w-full bg-white rounded-t-3xl p-5 pb-24 space-y-4 shadow-2xl",onClick:r[5]||(r[5]=A(()=>{},["stop"]))},[e("div",ne,[e("h3",de,m(s.preOrder?"Edit Pre-Order Product":"Add Pre-Order Product"),1)]),e("div",ie,[e("div",ue,[r[7]||(r[7]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Product ",-1)),N(e("select",{"onUpdate:modelValue":r[0]||(r[0]=c=>i.value=c),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none"},[r[6]||(r[6]=e("option",{value:""},"-- Create New Product --",-1)),(f(!0),p(I,null,L(y.value,c=>(f(),p("option",{key:c.product_id,value:c.product_id},m(c.name),9,ce))),128))],512),[[re,i.value]])]),i.value?b("",!0):(f(),p("div",fe,[r[8]||(r[8]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," New Product Name ",-1)),N(e("input",{"onUpdate:modelValue":r[1]||(r[1]=c=>a.name=c),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"e.g. Kuih Muih"},null,512),[[S,a.name]])])),e("div",pe,[r[9]||(r[9]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," SKU ",-1)),N(e("input",{"onUpdate:modelValue":r[2]||(r[2]=c=>a.sku=c),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"IP16-PRO-BLK"},null,512),[[S,a.sku]])]),e("div",xe,[e("div",be,[r[10]||(r[10]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Last Open Date ",-1)),N(e("input",{"onUpdate:modelValue":r[3]||(r[3]=c=>a.last_open_date=c),type:"date",disabled:!k.value,class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400"},null,8,me),[[S,a.last_open_date]])]),e("div",ve,[r[11]||(r[11]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Expected Receive Date ",-1)),N(e("input",{"onUpdate:modelValue":r[4]||(r[4]=c=>a.expected_receive_date=c),type:"date",disabled:!k.value,class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400"},null,8,_e),[[S,a.expected_receive_date]])])])]),e("div",{class:"flex gap-3 pt-4"},[e("button",{class:"flex-1 bg-slate-100 text-slate-600 font-bold rounded-xl py-3 active:scale-95 transition-all",onClick:g}," Cancel "),e("button",{class:"flex-1 bg-slate-800 text-white font-bold rounded-xl py-3 shadow-lg active:scale-95 transition-all",onClick:D}," Save ")])])])):b("",!0)}},he={class:"space-y-4"},ye={class:"flex flex-col gap-1"},we=["disabled"],ke={class:"grid grid-cols-2 gap-4 items-end"},Pe={class:"flex flex-col gap-1"},Oe=["disabled"],Ce={class:"flex flex-col gap-1"},Ee={class:"flex items-center justify-between bg-slate-50 p-1.5 rounded-xl border border-slate-100"},$e=["disabled"],Ne={class:"text-lg font-black text-slate-800"},Ae=["disabled"],De={key:0,class:"text-xs font-bold text-slate-400 uppercase tracking-wide"},Se={key:1,class:"text-sm font-bold text-rose-600"},je={class:"flex gap-3 pt-4"},Ie=["disabled"],ze=["disabled"],Fe={__name:"EditPreOrderCustomer",props:{open:Boolean,preOrder:{type:Object,required:!1,default:null}},emits:["close","saved"],setup(s,{emit:o}){const d=s,i=o,x=Q(),y=h(""),v=h(""),_=h(1),a=h(!1),k=h(null),g=T(()=>d.preOrder?.status==="OPEN");F(()=>d.preOrder,c=>{c&&(y.value="",v.value="",_.value=1)},{immediate:!0});function D(){i("close")}function P(c){if(!g.value||a.value)return;const u=_.value+c;u>=1&&(_.value=u)}async function r(){if(g.value){k.value=null,a.value=!0;try{await x.addCustomer({pre_order_id:d.preOrder.id,name:y.value.trim(),phone:v.value.trim(),qty:_.value}),i("saved"),i("close")}catch(c){k.value=c?.message||"Failed to save customer"}finally{a.value=!1}}}return(c,u)=>s.open?(f(),p("div",{key:0,class:"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm",onClick:D},[e("div",{class:"absolute bottom-0 w-full bg-white rounded-t-3xl p-5 pb-24 space-y-4 shadow-2xl",onClick:u[4]||(u[4]=A(()=>{},["stop"]))},[u[10]||(u[10]=e("div",{class:"flex justify-between items-center border-b pb-2"},[e("h3",{class:"text-lg font-bold text-slate-800"}," Add Customer ")],-1)),e("div",he,[e("div",ye,[u[5]||(u[5]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Customer Name ",-1)),N(e("input",{"onUpdate:modelValue":u[0]||(u[0]=E=>y.value=E),class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400",placeholder:"e.g. John Tan",disabled:!g.value||a.value},null,8,we),[[S,y.value]])]),e("div",ke,[e("div",Pe,[u[6]||(u[6]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Phone Number ",-1)),N(e("input",{"onUpdate:modelValue":u[1]||(u[1]=E=>v.value=E),type:"tel",class:"w-full border border-slate-200 rounded-xl p-3 focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-slate-100 disabled:text-slate-400",placeholder:"e.g. 012345...",disabled:!g.value||a.value},null,8,Oe),[[S,v.value]])]),e("div",Ce,[u[9]||(u[9]=e("label",{class:"text-xs font-bold text-slate-500 uppercase ml-1"}," Quantity ",-1)),e("div",Ee,[e("button",{type:"button",class:"w-9 h-9 flex items-center justify-center rounded-lg bg-white border border-slate-200 shadow-sm active:scale-90 disabled:opacity-50",onClick:u[2]||(u[2]=E=>P(-1)),disabled:_.value<=1||!g.value||a.value},[...u[7]||(u[7]=[e("span",{class:"text-lg font-bold text-slate-600"},"âˆ’",-1)])],8,$e),e("span",Ne,m(_.value),1),e("button",{type:"button",class:"w-9 h-9 flex items-center justify-center rounded-lg bg-slate-800 text-white shadow-md active:scale-90 disabled:opacity-50",onClick:u[3]||(u[3]=E=>P(1)),disabled:!g.value||a.value},[...u[8]||(u[8]=[e("span",{class:"text-lg font-bold"},"+",-1)])],8,Ae)])])]),g.value?b("",!0):(f(),p("p",De," Customer can only be edited while status is OPEN ")),k.value?(f(),p("p",Se,m(k.value),1)):b("",!0)]),e("div",je,[e("button",{class:"flex-1 bg-slate-100 text-slate-600 font-bold rounded-xl py-3 active:scale-95 transition-all",onClick:D,disabled:a.value}," Cancel ",8,Ie),e("button",{class:"flex-1 bg-slate-800 text-white font-bold rounded-xl py-3 shadow-lg active:scale-95 transition-all disabled:bg-slate-400",onClick:r,disabled:a.value||!g.value},m(a.value?"Saving...":"Save"),9,ze)])])])):b("",!0)}},Te={class:"p-4 pb-24 space-y-3 bg-slate-50 min-h-screen font-sans"},Le={key:0,class:"text-center py-20 text-slate-400"},Be={class:"bg-white rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden h-28 flex z-20"},Ue=["onClick"],Ve={class:"space-y-1"},qe={class:"font-black text-slate-800 leading-tight truncate w-48 text-base"},Me={class:"text-[10px] text-slate-400 font-bold uppercase tracking-wide"},Qe={class:"flex gap-1.5 mt-2"},Re={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-red-200 text-slate-600"},Ze={class:"text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg bg-slate-100 text-slate-600"},Ke=["onClick"],Ge={class:"absolute right-0 top-0 bottom-0 z-10 flex h-full bg-slate-50"},Xe=["onClick"],Je=["onClick"],He=["onClick"],We=["onClick"],Ye={key:0,class:"bg-white/60 border-x border-b border-slate-100 rounded-b-2xl -mt-4 pt-6 p-4 space-y-3 z-10 shadow-inner"},et={key:0,class:"flex items-center justify-center py-4 gap-2"},tt={key:1,class:"space-y-2"},st={class:"flex gap-3 items-center"},ot={class:"h-6 w-6 flex items-center justify-center bg-slate-100 rounded-lg font-black text-slate-700"},rt={class:"flex flex-col"},lt={class:"font-bold text-slate-800"},at={class:"text-[10px] text-slate-400"},nt=["onClick"],dt={class:"pt-2 border-t border-dashed border-slate-200 flex justify-between items-center px-1"},it={class:"text-[10px] font-bold text-slate-400 uppercase"},ut={class:"text-xs font-black text-slate-800"},ct={key:2,class:"text-center py-2 text-[10px] font-bold text-slate-400 uppercase"},bt={__name:"PreOrderList",setup(s){const o=Q(),d=M(),i=C(),x=h(null),y=h(!1),v=h(!1),_=h(!1),a=h(!1),k=h(null);q(()=>{o.fetchPreOrders()});function g(t){if(t._showActions){t._showActions=!1;return}t._expanded=!t._expanded,t._expanded&&(!t.customers||t.customers.length===0)&&o.fetchPreOrderDetails(t.id)}function D(t){t._showActions||(t._expanded=!1),o.items.forEach(n=>{n.id!==t.id&&(n._showActions=!1)}),t._showActions=!t._showActions}function P(t){return t.status==="OPEN"||t.status==="FINALIZED"}function r(t){return t.status==="OPEN"?192:t.status==="FINALIZED"?64:0}function c(t){return(t.customers||[]).reduce((n,l)=>n+l.qty,0)}function u(t){return t==="OPEN"?"bg-amber-100 text-amber-700":t==="FINALIZED"?"bg-sky-100 text-sky-700":"bg-emerald-100 text-emerald-700"}function E(){y.value=null,x.value=null,v.value=!0}function R(t){y.value=t,t._showActions=!1,x.value=t,v.value=!0}function Z(t){t._showActions=!1,x.value=t,_.value=!0}async function K(t){if(!confirm("Finalize this pre-order?"))return;t._showActions=!1;const n=await o.finalize(t);n.productExists||(k.value={product_id:n.productData.product_id,name:n.productData.name,sku:n.productData.sku,stock:0,cost_price:0,sell_price:0},a.value=!0)}function G(t){confirm("Receiving will generate customer orders automatically. Continue?")&&(t._showActions=!1,o.received(t))}function X(t,n){confirm("Remove this customer?")&&o.removeCustomer(t.id,n.id)}function j(){v.value=!1,_.value=!1,x.value=null,y.value=!1}async function J(t){y.value?await o.updatePreOrder(t):await o.createPreOrder(t),j()}async function H(t){j()}async function W(t){await d.addProduct(t),i.success("Product added"),a.value=!1}function Y(t){if(!t)return"";const n=new Date(t);return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(n)}return(t,n)=>(f(),p(I,null,[e("div",Te,[e("div",{class:"flex justify-between items-center mb-2"},[n[2]||(n[2]=e("h2",{class:"text-xl font-black text-slate-800 tracking-tight"},"Pre-Orders",-1)),e("button",{class:"w-10 h-10 flex items-center justify-center rounded-xl bg-slate-800 text-white shadow-sm active:scale-90 transition-all",onClick:E},[...n[1]||(n[1]=[e("span",{class:"text-xl"},"+",-1)])])]),U(o).loading?(f(),p("div",Le,[...n[3]||(n[3]=[e("div",{class:"animate-spin inline-block w-8 h-8 border-4 border-slate-300 border-t-slate-800 rounded-full mb-4"},null,-1),e("p",{class:"font-bold text-sm"},"Synchronizing Pre-Orders...",-1)])])):b("",!0),(f(!0),p(I,null,L(U(o).items,l=>(f(),p("div",{key:l.id,class:"flex flex-col mb-4"},[e("div",Be,[e("div",{class:"absolute inset-0 z-20 bg-white p-4 flex justify-between items-center transition-transform duration-300 ease-out",style:le({transform:l._showActions?`translateX(-${r(l)}px)`:"translateX(0)"}),onClick:w=>g(l)},[e("div",Ve,[e("div",qe,m(l.name),1),e("div",Me,m(l.sku),1),e("div",Qe,[e("span",{class:V(["text-[8px] uppercase tracking-tighter font-black px-2 py-1 rounded-lg",u(l.status)])},m(l.status),3),e("span",Re," ðŸ“… "+m(Y(l.last_open_date)),1),e("span",Ze," Qty : "+m(c(l)),1)])]),P(l)?(f(),p("button",{key:0,onClick:A(w=>D(l),["stop"]),class:"w-12 h-12 flex items-center justify-center text-slate-300 active:text-blue-500 transition-colors"},[e("i",{class:V(["fa text-2xl transition-transform duration-300",l._showActions?"fa-chevron-right":"fa-chevron-left"])},null,2)],8,Ke)):b("",!0)],12,Ue),e("div",Ge,[l.status==="OPEN"?(f(),p("button",{key:0,class:"w-16 bg-sky-500 text-white flex flex-col items-center justify-center gap-1",onClick:A(w=>R(l),["stop"])},[...n[4]||(n[4]=[e("i",{class:"fa fa-pencil text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Edit",-1)])],8,Xe)):b("",!0),l.status==="OPEN"?(f(),p("button",{key:1,class:"w-16 bg-amber-400 text-amber-900 flex flex-col items-center justify-center gap-1",onClick:A(w=>Z(l),["stop"])},[...n[5]||(n[5]=[e("i",{class:"fa fa-user-plus text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Add",-1)])],8,Je)):b("",!0),l.status==="OPEN"?(f(),p("button",{key:2,class:"w-16 bg-slate-800 text-white flex flex-col items-center justify-center gap-1",onClick:A(w=>K(l),["stop"])},[...n[6]||(n[6]=[e("i",{class:"fa fa-lock text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Finalize",-1)])],8,He)):b("",!0),l.status==="FINALIZED"?(f(),p("button",{key:3,class:"w-16 bg-emerald-500 text-white flex flex-col items-center justify-center gap-1",onClick:A(w=>G(l),["stop"])},[...n[7]||(n[7]=[e("i",{class:"fa fa-check-circle text-xl"},null,-1),e("span",{class:"text-[9px] font-black uppercase"},"Received",-1)])],8,We)):b("",!0)])]),l._expanded?(f(),p("div",Ye,[l._loadingItems?(f(),p("div",et,[...n[8]||(n[8]=[e("div",{class:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"},null,-1),e("span",{class:"text-[11px] font-bold text-slate-400 uppercase tracking-widest"},"Fetching Details",-1)])])):l.customers&&l.customers.length?(f(),p("div",tt,[(f(!0),p(I,null,L(l.customers,w=>(f(),p("div",{key:w.id,class:"flex justify-between items-center text-xs bg-white p-2 rounded-xl border border-slate-50 shadow-sm"},[e("div",st,[e("span",ot,m(w.qty),1),e("div",rt,[e("span",lt,m(w.name),1),e("span",at,m(w.phone||""),1)])]),l.status==="OPEN"?(f(),p("button",{key:0,class:"text-rose-500 text-xs font-bold active:opacity-50",onClick:ft=>X(l,w)}," Delete ",8,nt)):b("",!0)]))),128)),e("div",dt,[e("span",it,"Total Customers: "+m(l.customers.length),1),e("span",ut,"Qty "+m(c(l)),1)])])):(f(),p("div",ct," No customers "))])):b("",!0)]))),128))]),v.value?(f(),z(ge,{key:0,open:v.value,preOrder:x.value,onClose:j,onSave:J},null,8,["open","preOrder"])):b("",!0),_.value&&x.value?(f(),z(Fe,{key:1,open:_.value,preOrder:x.value,onClose:j,onSaved:H},null,8,["open","preOrder"])):b("",!0),a.value?(f(),z(ae,{key:2,open:a.value,product:k.value,onClose:n[0]||(n[0]=l=>a.value=!1),onSave:W},null,8,["open","product"])):b("",!0)],64))}};export{bt as default};
